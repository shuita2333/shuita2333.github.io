<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>软件安全课程笔记 | ZYH's blog</title><meta name="author" content="Charmes"><meta name="copyright" content="Charmes"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="referrer" content="no-referrer"><meta name="description" content="软件安全的初步总结，供参考">
<meta property="og:type" content="article">
<meta property="og:title" content="软件安全课程笔记">
<meta property="og:url" content="https://zhangyuanhe.top/2024/01/15/BUPT_note/Notes%20on%20software%20security/index.html">
<meta property="og:site_name" content="ZYH&#39;s blog">
<meta property="og:description" content="软件安全的初步总结，供参考">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://zyhblog-1318929733.cos.ap-beijing.myqcloud.com/tags1-1690700892780-1.png">
<meta property="article:published_time" content="2024-01-15T13:00:00.000Z">
<meta property="article:modified_time" content="2024-01-17T12:52:36.357Z">
<meta property="article:author" content="Charmes">
<meta property="article:tag" content="北邮信安">
<meta property="article:tag" content="学习笔记">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zyhblog-1318929733.cos.ap-beijing.myqcloud.com/tags1-1690700892780-1.png"><link rel="shortcut icon" href="/img/logo.png"><link rel="canonical" href="https://zhangyuanhe.top/2024/01/15/BUPT_note/Notes%20on%20software%20security/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":true,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":100,"languages":{"author":"作者: Charmes","link":"链接: ","source":"来源: ZYH's blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '软件安全课程笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-01-17 20:52:36'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 8 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/universe.css"><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><span id="fps"></span><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ZYH's blog" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/favicon1.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">69</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">18</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">14</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 有链</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-heart"></i><span> 关于</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-address-card"></i><span> 关于作者</span></a></li><li><a class="site-page child" href="javascript:randomPost();"><i class="fa-fw fa-solid fa-shuffle"></i><span> 随便看看</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://zyhblog-1318929733.cos.ap-beijing.myqcloud.com/tags1-1690700892780-1.png')"><nav id="nav"><span id="blog-info"><a href="/" title="ZYH's blog"><img class="site-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/logo.png"/><span class="site-name">ZYH's blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 有链</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-heart"></i><span> 关于</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-address-card"></i><span> 关于作者</span></a></li><li><a class="site-page child" href="javascript:randomPost();"><i class="fa-fw fa-solid fa-shuffle"></i><span> 随便看看</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">软件安全课程笔记</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-01-15T13:00:00.000Z" title="发表于 2024-01-15 21:00:00">2024-01-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-01-17T12:52:36.357Z" title="更新于 2024-01-17 20:52:36">2024-01-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/">课程笔记</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>28分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="软件安全课程笔记"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="软件安全-张淼"><a href="#软件安全-张淼" class="headerlink" title="软件安全 张淼"></a>软件安全 张淼</h1><h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h3 id="信息安全现状"><a href="#信息安全现状" class="headerlink" title="信息安全现状"></a>信息安全现状</h3><p><strong>信息安全现象</strong></p>
<p>➔ <strong>病毒、黑客攻击的泛滥</strong></p>
<p>➢数量规模大、智能程度高（技术含量）、组织方式多样化（个人、组织和集团等）</p>
<p>➢危害程度严重</p>
<p>➔ <strong>信息安全成为国家安全的重要内容</strong></p>
<p>➢国家领导层的意识</p>
<p>➢信息化建设的经验、伊战的教训</p>
<p>➔ <strong>关键技术受制于人</strong></p>
<p>➢CPU、OS</p>
<p>➢专利、标准</p>
<h3 id="信息安全威胁"><a href="#信息安全威胁" class="headerlink" title="信息安全威胁"></a><strong><strong>信息安全威胁</strong></strong></h3><p>信息安全威胁的表现：</p>
<p>➔ 网络协议的弱点</p>
<p>➔ 网络操作系统的漏洞</p>
<p>➔ 应用系统设计的漏洞</p>
<p>➔ 网络系统设计的缺陷</p>
<p>➔ 恶意攻击</p>
<p>➔ 来自合法用户的攻击</p>
<p>➔ 互联网的开放性</p>
<p>➔ 物理安全</p>
<p>➔ 管理安全</p>
<p>威胁的根源</p>
<p>➔ <strong>信息系统的复杂性：</strong></p>
<p>➢系统软硬件缺陷，网络协议的缺陷</p>
<p>➔ <strong>信息系统的开放性：</strong></p>
<p>➢系统开放：计算机及计算机通信系统是根据行业标准规定的接口建立起来的。</p>
<p>➢标准开放：网络运行的各层协议是开放的，并且标准的制定也是开放的。</p>
<p>➢业务开放：用户可以根据需要开发新的业务。</p>
<h2 id="问题的原因和根源"><a href="#问题的原因和根源" class="headerlink" title="问题的原因和根源"></a><strong><strong>问题的原因和根源</strong></strong></h2><h3 id="软件问题的原因"><a href="#软件问题的原因" class="headerlink" title="软件问题的原因"></a><strong><strong>软件问题的原因</strong></strong></h3><p>⚫<strong>Connectivity（互联性）</strong></p>
<ul>
<li>终端设备的互联给了攻击者有更多的机会</li>
<li>攻击者利用系统弱点不再需要进行物理访问</li>
<li>平台设计缺陷</li>
</ul>
<p>⚫<strong>Extensibility（扩展性）</strong></p>
<ul>
<li>目前很多软件技术都支持扩展技术</li>
<li>优点在于可以很方便的加载以及扩展新的功能与组件</li>
<li>问题在于扩展的功能与组件不可控，会带来未知的安全风险</li>
</ul>
<p>⚫<strong>Complexity（复杂性</strong>）</p>
<ul>
<li>软件系统代码增长速度惊人</li>
</ul>
<p>系统越复杂，Bug越难避免，质量越难保证，可能发生的安全风险越多。</p>
<h3 id="新的需求与传统安全技术的不足"><a href="#新的需求与传统安全技术的不足" class="headerlink" title="新的需求与传统安全技术的不足"></a><strong><strong>新的需求与传统安全技术的不足</strong></strong></h3><p>传统网络安全技术只能对网络层进行防护</p>
<p>无法分辨与正常应用数据混杂在一起的攻击</p>
<p>➔<strong>XSS</strong></p>
<p>➔<strong>SQL注入</strong></p>
<p>➔<strong>未校验参数</strong></p>
<p>➔<strong>etc.</strong></p>
<table>
<thead>
<tr>
<th>传统的安全模式</th>
<th>新的安全模式</th>
</tr>
</thead>
<tbody><tr>
<td>保护”边界”</td>
<td>构建安全的系统</td>
</tr>
<tr>
<td>网络安全</td>
<td>设计安全的软件</td>
</tr>
<tr>
<td>安全负责的人是 IT&#x2F;MIS&#x2F;CISSP等部门</td>
<td>软件开发人员和设计人员对安全负责</td>
</tr>
<tr>
<td>被动式</td>
<td>主动式</td>
</tr>
</tbody></table>
<h1 id="缓冲区溢出基础"><a href="#缓冲区溢出基础" class="headerlink" title="缓冲区溢出基础"></a>缓冲区溢出基础</h1><h2 id="缓冲区溢出概述－缓冲区溢出原理简介"><a href="#缓冲区溢出概述－缓冲区溢出原理简介" class="headerlink" title="缓冲区溢出概述－缓冲区溢出原理简介"></a>缓冲区溢出概述－缓冲区溢出原理简介</h2><p>缓冲区溢出是指当计算机向缓冲区内填充数据位数时超过了缓冲区本身的容量溢出的数据覆盖在合法数据上。</p>
<p>在初始化、拷贝或移动数据时，C语言并不自动地支持内在的数组边界检查。</p>
<p><strong>目前对于缓冲区溢出,主要分为静态保护和动态保护:</strong></p>
<p>⚫**静态保护:**不执行代码,通过静态分析来发现代码中可能存在的漏洞.静态的保护技术包括编译时加入限制条件,返回地址保护,二进制改写技术,基于源码的代码审计等.</p>
<p>⚫**动态保护:**通过执行代码分析程序的特性,测试是否存在漏洞,或者是保护主机上运行的程序来防止来自外部的缓冲区溢出攻击</p>
<h2 id="PE文件格式简介"><a href="#PE文件格式简介" class="headerlink" title="PE文件格式简介"></a>PE文件格式简介</h2><p>PE(Portable Executable)是Win32平台下可执行文件遵守的数据格式。常见的可执行文件(如“*.exe”文件和“*.dll”文件)都是典型的PE文件。</p>
<p>PE 文 件 格 式 把 可 执 行 文 件 分 成 若 干 个 数 据 节(section)，不通的资源被存放在不同的节中。一个典型的PE文件包含的节如下：</p>
<p>➔ .text 由编译器产生，存放着二进制的机器代码，也是我们反汇编和调试的对象。<br>➔ .data 初始化的数据块，如宏定义、全局变量、静态变量等。<br>➔ .idata 可执行文件所使用的动态链接库等外来函数与文件的信息。<br>➔ .rsrc 存放程序的资源，如图标、菜单等。<br>➔ 除此之外 ， 还 可 能 出 现 的 节 包 括 “.reloc” 、“.edata”、 “.tls”、 “.rdata”等。</p>
<p><strong>PE文件简单构成</strong></p>
<table>
<thead>
<tr>
<th>其他</th>
</tr>
</thead>
<tbody><tr>
<td>.data节</td>
</tr>
<tr>
<td>.rdata节</td>
</tr>
<tr>
<td>.text节</td>
</tr>
<tr>
<td>文件头、节</td>
</tr>
<tr>
<td>表等</td>
</tr>
</tbody></table>
<h2 id="虚拟内存相关知识—虚拟内存简介"><a href="#虚拟内存相关知识—虚拟内存简介" class="headerlink" title="虚拟内存相关知识—虚拟内存简介"></a>虚拟内存相关知识—虚拟内存简介</h2><p>Windows的内存可以被分为两个层面：物理内存和虚拟内存 。 其 中 ， 物理内存比较复杂 ， 需要进入Windows内核级别ring0才能看到。通常，在用户模式下，我们用调试器看到的地址都是虚拟内存。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyhblog-1318929733.cos.ap-beijing.myqcloud.com/Untitled.png" alt="Untitled"></p>
<p>虽然每个进程都“相信”自己拥有4GB的空间，但实际上它们运行时真正能用到的空间根本没有那么多。</p>
<p>内存管理器只是分给进程一片“假地址”，或者说是“虚拟地址”，它们对进程来说只是一笔“无形的数字财富”；</p>
<p>当需要实际的内存操作时，内存管理器才会把“虚拟地址”和“物理地址”联系起来。</p>
<h2 id="PE文件与虚拟内存之间的映射"><a href="#PE文件与虚拟内存之间的映射" class="headerlink" title="PE文件与虚拟内存之间的映射"></a><strong>PE文件与虚拟内存之间的映射</strong></h2><p>静态反汇编工具看到的PE文件中某条指令的位置是相对于磁盘文件而言的，即所谓的文件偏移，我们可能还需要知道这条指令在内存中所处的位置，即虚拟内存的位置</p>
<p>反之，在调试时看到的某条指令的地址是虚拟内存地址，我们也经常需要回到PE文件中找到这条指令对应的机器码</p>
<h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a><strong>概念</strong></h3><p>⚫ <strong>文件偏移地址(File Offset)</strong></p>
<p>➢数据在PE文件中的地址叫做文件偏移地址。这是文件在磁盘上存放时相对于文件开头的偏移。</p>
<p>⚫ <strong>装载基址(Image Base)</strong></p>
<p>➢PE装入内存时的基地址。默认情况下，EXE文件在内存中的基地址是0x00400000,DLL文件是0x10000000。这些位置可以通过修改编译选项更改。</p>
<p>⚫ <strong>虚拟内存地址(Virtual Address,VA)</strong></p>
<p>➢PE文件中的指令被装入内存后的地址。</p>
<p>⚫ <strong>相对虚拟地址(Relative Virtual Address,RVA)</strong></p>
<p>➢相对虚拟地址是内存地址相对于映射基址的偏移量。</p>
<h2 id="系统栈的工作原理—内存的不同用途"><a href="#系统栈的工作原理—内存的不同用途" class="headerlink" title="系统栈的工作原理—内存的不同用途"></a><strong><strong>系统栈的工作原理—内存的不同用途</strong></strong></h2><p>成功地利用缓冲区溢出漏洞可以修改内存中的变量的值，甚至可以劫持进程，执行恶意代码，最终获得主机的控制权。</p>
<h3 id="寄存器"><a href="#寄存器" class="headerlink" title="寄存器"></a><strong>寄存器</strong></h3><p>⚫ 通用寄存器</p>
<p>➔ 32位的通用寄存器有<em>EAX</em>、<em>EBX</em>、<em>ECX</em>、<em>EDX</em>、<em>ESP</em>、<em>EBP</em>、<em>ESI</em>和<em>EDL</em>，它们的使用方法不总是相同的。一些指令赋予它们特殊的功能。</p>
<p>⚫ 段寄存器</p>
<p>➔ 段寄存器被用于指向进程地址空间不同的段。</p>
<p>➔ <em>CS</em>指向一个代码段的开始；</p>
<p>➔ <em>SS</em>是一个堆栈段；</p>
<p>➔ <em>DS</em>、<em>ES</em>、<em>FS</em>、<em>GS</em>和各种其他数据段，例如存储静态数据的段。</p>
<p>⚫ 程序流控制寄存器</p>
<p>⚫ 其他寄存器</p>
<p>程序员习惯中已经默认的给每个寄存器赋上了特殊的含义，比如：</p>
<p>➔ EAX一般用来做返回值<br>➔ ECX用于记数<br>➔ EIP：扩展指令指针。在调用一个函数时，这个指针被存储在堆栈中，用于后面的使用。在函数返回时，这个被存储的地址被用于决定下一个将被执行的指令的地址。<br>➔ ESP：扩展堆栈指针。这个寄存器指向堆栈的当前位置，并允许通过使用push和pop操作或者直接的指针操作来对堆栈中的内容进行添加和移除。<br>➔ EBP：扩展基指针。主要用与存放在进入call以后的ESP的值，便于退出的时候回复ESP的值，达到堆栈平衡的目的</p>
<p>内存的4个部分和相关用途:</p>
<table>
<thead>
<tr>
<th>名称</th>
<th>用途</th>
</tr>
</thead>
<tbody><tr>
<td>代码区</td>
<td>这个区域存储着被装入执行的二进制机器代码，处理器会到这个区域取指并执行。</td>
</tr>
<tr>
<td>数据区</td>
<td>用于存储全局变量等。</td>
</tr>
<tr>
<td>堆区</td>
<td>进程可以在堆区动态地请求一定大小的内存，并在用完之后归还给堆区。动态分配和回收是堆区的特点。</td>
</tr>
<tr>
<td>栈区</td>
<td>用于动态地存储函数之间的调用关系，以保证被调用函数在返回时恢复到父函数中继续执行。</td>
</tr>
</tbody></table>
<h3 id="栈与系统栈"><a href="#栈与系统栈" class="headerlink" title="栈与系统栈"></a><strong><strong>栈与系统栈</strong></strong></h3><p>从计算机科学的角度来看，栈指的是一种数据结构，是一种先进后出的数据表。栈的最常见操作有两种：压栈(PUSH)、弹栈(POP)；用于标识栈的属性也有两个：栈顶(TOP)、栈底(BASE)。</p>
<p>内存的栈区实际上指的就是系统栈。系统栈由系统自动维护，它用于实现高级语言中函数的调用。对 于 类 似 C 语 言 这 样 的 高 级 语 言 ， 系 统 栈 的PUSH&#x2F;POP等堆栈平衡细节是透明的。</p>
<table>
<thead>
<tr>
<th>代码空间</th>
<th>系统栈空间</th>
</tr>
</thead>
<tbody><tr>
<td>程序被装入，由main函数代码空间依次取指执行</td>
<td>系统栈 栈顶为当前正在执行的main函数栈帧</td>
</tr>
<tr>
<td>执行到main代码区的call指令时，跳转到funca的代码区继续执行</td>
<td>为配合funca的执行，在系统栈中为其开辟新的栈帧并压入</td>
</tr>
<tr>
<td>执行到funca代码区的call指令时，跳转到funcb的代码区继续执行</td>
<td></td>
</tr>
<tr>
<td>为配合funcb的执行，在系统栈中为其开辟新的栈帧并压入</td>
<td></td>
</tr>
<tr>
<td>funcb代码执行完毕，弹出自己的栈帧并从中获得返回地址，跳回funca代码区继续执行</td>
<td>弹出funcb的栈帧。对应于当前正在执行的函数，当前栈顶栈帧重新恢复成funca函数栈帧</td>
</tr>
<tr>
<td>funca代码执行完毕，弹出自己的栈帧并从中获得返回地址，跳回main代码区继续执行</td>
<td>弹出funca的栈帧。对应于当前正在执行的函数，当前栈顶栈帧重新恢复成main函数栈帧</td>
</tr>
</tbody></table>
<h2 id="寄存器与函数栈帧"><a href="#寄存器与函数栈帧" class="headerlink" title="寄存器与函数栈帧"></a><strong><strong>寄存器与函数栈帧</strong></strong></h2><p>（1）ESP：栈指针寄存器(extended stackpointer),其内存放着一个指针，该指针永远指向系统栈最上面的一个栈帧的栈顶。</p>
<p>（2）EBP：基址指针寄存器(extended basepointer),其内存放着一个指针，该指针永远指向系统栈最上面的一个栈帧的底部。</p>
<p>（3）EIP ：指令寄存器 (Extended InstructionPointer),其内存放着一个指针，该指针永远指向一条等待执行的指令地址。</p>
<p><strong>在函数栈帧中，一般包含以下几类重要信息。</strong></p>
<p>（1）局部变量：为函数局部变量开辟的内存空间。</p>
<p>（2）栈帧状态值：保存前栈帧的顶部和底部（实际上只保存前栈帧的底部，前栈帧的顶部可以通过堆栈平衡计算得到），用于在本帧被弹出后恢复出上一个栈帧。</p>
<p>（3）函数返回地址：保存当前函数调用前的“断点”信息，也就是函数调用前的指令位置，以便在函数返回时能够恢复到函数被调用前的代码区中继续执行指令</p>
<p><strong>函数调用步骤</strong></p>
<p>（1）参数入栈：将参数从右向左一次压入系统栈中。</p>
<p>（2）返回地址入栈：将当前代码区调用指令的下一跳指令地址压入栈中，<br>供函数返回时继续执行。</p>
<p>（3）代码区跳转：处理器从当前代码区跳转到被调用函数的入口处。</p>
<p>（4）栈帧调整</p>
<ul>
<li>保存当前栈帧的状态值，以备后面恢复本栈帧时使用（EBP入栈）；</li>
<li>将当前栈帧切换到新栈帧（将ESP值装入EBP，更新栈帧底部）；</li>
<li>给新栈帧分配空间（把ESP减去所需空间的大小，抬高栈帧）；</li>
</ul>
<h2 id="函数调用约定与相关指令"><a href="#函数调用约定与相关指令" class="headerlink" title="函数调用约定与相关指令"></a><strong>函数调用约定与相关指令</strong></h2><p>入栈</p>
<table>
<thead>
<tr>
<th>序列</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>push 参数 3</td>
<td>假设该函数有3个参数，将从右向左依次入栈</td>
</tr>
<tr>
<td>push 参数 2</td>
<td></td>
</tr>
<tr>
<td>push 参数 1</td>
<td></td>
</tr>
<tr>
<td>call 函数地址</td>
<td>call指令将同时完成两项工作:a)向栈中压入当前指令在内存中的位置，即保存返回地址。</td>
</tr>
<tr>
<td>b)跳转到所调用函数的入口地址函数入口处</td>
<td></td>
</tr>
<tr>
<td>push ebp</td>
<td>保存旧栈帧的底部</td>
</tr>
<tr>
<td>mov ebp,esp</td>
<td>设置新栈帧的底部(栈帧切换)</td>
</tr>
<tr>
<td>sub esp,xxx</td>
<td>sub esp,xxx 设置新栈帧的顶部(抬高栈顶，为新栈帧开辟空间）</td>
</tr>
</tbody></table>
<p>类似的，函数返回的步骤如下。<br>（1）保存返回值：通常将函数的返回值保存在寄存器EAX中。<br>（2）弹出当前栈帧，恢复上一个栈帧，具体包括：</p>
<p>在堆栈平衡的基础上，给ESP加上栈帧的大小，降低栈顶，回收当前栈帧的空间。</p>
<p>将当前栈帧底部保存的前栈帧EBP值弹入EBP寄存器，恢复上一个栈帧。</p>
<p>将函数返回地址弹给EIP寄存器。</p>
<p>（3）跳转：按照函数返回地址跳回母函数中继续执行。</p>
<table>
<thead>
<tr>
<th>指令</th>
<th>备注</th>
</tr>
</thead>
<tbody><tr>
<td>add esp,xxx</td>
<td>降低栈顶，回收当前的栈帧</td>
</tr>
<tr>
<td>pop ebp</td>
<td>将上一个栈帧底部位置恢复到ebp</td>
</tr>
<tr>
<td>retn</td>
<td>这条指令有两个功能:</td>
</tr>
<tr>
<td>a)弹出当前栈顶元素，即弹出栈帧中的返回地址。至此，栈帧恢复工作完成。</td>
<td></td>
</tr>
<tr>
<td>b)让处理器跳转到弹出的返回地址，恢复调用前的代码区</td>
<td></td>
</tr>
</tbody></table>
<h1 id="第三讲-字符串安全"><a href="#第三讲-字符串安全" class="headerlink" title="第三讲 字符串安全"></a><strong><strong>第三讲 字符串安全</strong></strong></h1><h2 id="C-风格的字符串"><a href="#C-风格的字符串" class="headerlink" title="C-风格的字符串"></a><strong><strong>C-风格的字符串</strong></strong></h2><p>c风格的字符串由一个连续的字符序列组成，并以一个空字符（null ）作为结束。</p>
<p>➔ 一个指向字符串的指针实际上就是指向该字符串的起始字符。</p>
<p>➔ 字符串长度指空字符之前的字节数</p>
<p>➔ 字符串的值则是它所包含的按顺序排列的字符序列。</p>
<p>➔ 存储一个字符串所需要的字节数是字符串的字符数加1。 (x 是每个字符的大小)</p>
<h2 id="C-字符串"><a href="#C-字符串" class="headerlink" title="C++ 字符串"></a><strong><strong>C++ 字符串</strong></strong></h2><p>C++的标准化促进了：</p>
<p>➔ <strong>标准的类模板std::basic_string</strong></p>
<p>➔ 及它的<strong>char</strong> 实例化 <strong>std::string</strong></p>
<p>➔ 相对于C风格的字符串，<strong>basic_string</strong> 类更不容易出现安全漏洞 。</p>
<h2 id="常见的字符串操作错误"><a href="#常见的字符串操作错误" class="headerlink" title="常见的字符串操作错误"></a><strong><strong>常见的字符串操作错误</strong></strong></h2><p>最常见的错误有<br>➢ 无界字符串复制<br>➢ 空结尾错误<br>➢ 截断<br>➢ 差－错误<br>➢ 数组写入越界<br>➢ 不恰当的数据处理</p>
<h2 id="无边界字符串复制"><a href="#无边界字符串复制" class="headerlink" title="无边界字符串复制"></a><strong><strong>无边界字符串复制</strong></strong></h2><p>无边界字符串复制发生于从一个无边界数据源复制数据到一个定长的字符数组时</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line"><span class="type">char</span> Password[<span class="number">80</span>];</span><br><span class="line"><span class="built_in">puts</span>(<span class="string">&quot;Enter 8 character password:&quot;</span>);</span><br><span class="line"><span class="built_in">gets</span>(Password);</span><br><span class="line">...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>复制和连接字符串时也容易出现错误，因为标准strcpy() 和strcat() 函数执行的都是无边界复制操作</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span> </span>&#123;</span><br><span class="line"><span class="number">2.</span> <span class="type">char</span> name[<span class="number">2048</span>];</span><br><span class="line"><span class="number">3.</span> <span class="built_in">strcpy</span>(name, argv[<span class="number">1</span>]);</span><br><span class="line"><span class="number">4.</span> <span class="built_in">strcat</span>(name, <span class="string">&quot; = &quot;</span>);</span><br><span class="line"><span class="number">5.</span> <span class="built_in">strcat</span>(name, argv[<span class="number">2</span>]);</span><br><span class="line">...</span><br><span class="line"><span class="number">6.</span> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="简单的解决方案"><a href="#简单的解决方案" class="headerlink" title="简单的解决方案"></a><strong><strong>简单的解决方案</strong></strong></h3><p>利用strlen() 测试输入字符串的长度然后动态分配内存。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span> </span>&#123;</span><br><span class="line"><span class="number">2.</span> <span class="type">char</span> *buff = (<span class="type">char</span>*)<span class="built_in">malloc</span>(<span class="built_in">strlen</span>(argv[<span class="number">1</span>])+<span class="number">1</span>);</span><br><span class="line"><span class="number">3.</span> <span class="keyword">if</span> (buff != <span class="literal">NULL</span>) &#123;</span><br><span class="line"><span class="number">4.</span> <span class="built_in">strcpy</span>(buff, argv[<span class="number">1</span>]);</span><br><span class="line"><span class="number">5.</span> <span class="built_in">printf</span>(<span class="string">&quot;argv[1] = %s.\n&quot;</span>, buff);</span><br><span class="line"><span class="number">6.</span> &#125;</span><br><span class="line"><span class="number">7.</span> <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="comment">/* Couldn&#x27;t get the memory - recover*/</span></span><br><span class="line"><span class="number">8.</span> &#125;</span><br><span class="line"><span class="number">9.</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="number">10.</span> &#125;</span><br></pre></td></tr></table></figure>

<h2 id="C-无界字符串复制"><a href="#C-无界字符串复制" class="headerlink" title="C++无界字符串复制"></a><strong><strong>C++无界字符串复制</strong></strong></h2><p>对于下列的C＋＋程序，如果用户输入多于11个字符，也会导<br>致越界写。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream.h&gt;</span></span></span><br><span class="line"><span class="number">2.</span> <span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line"><span class="number">3.</span> <span class="type">char</span> buf[<span class="number">12</span>];</span><br><span class="line"><span class="number">4.</span> cin &gt;&gt; buf;</span><br><span class="line"><span class="number">5.</span> cout &lt;&lt; <span class="string">&quot;echo: &quot;</span> &lt;&lt; buf &lt;&lt; endl;</span><br><span class="line"><span class="number">6.</span> &#125;</span><br></pre></td></tr></table></figure>

<h3 id="简单的解决方案-1"><a href="#简单的解决方案-1" class="headerlink" title="简单的解决方案"></a><strong><strong>简单的解决方案</strong></strong></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream.h&gt;</span></span></span><br><span class="line"><span class="number">2.</span> <span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">void</span>)</span> </span>&#123;</span><br><span class="line"><span class="number">3.</span> <span class="type">char</span> buf[<span class="number">12</span>];</span><br><span class="line"><span class="number">3.</span> cin.<span class="built_in">width</span>(<span class="number">12</span>);</span><br><span class="line"><span class="number">4.</span> cin &gt;&gt; buf;</span><br><span class="line"><span class="number">5.</span> cout &lt;&lt; <span class="string">&quot;echo: &quot;</span> &lt;&lt; buf &lt;&lt; endl;</span><br><span class="line"><span class="number">6.</span> &#125;</span><br></pre></td></tr></table></figure>

<h2 id="空结尾错误"><a href="#空结尾错误" class="headerlink" title="空结尾错误"></a><strong><strong>空结尾错误</strong></strong></h2><p>当使用C风格字符时，另一个常见的问题是字符串末尾没有正确的空字符。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>* argv[])</span> </span>&#123;</span><br><span class="line"><span class="type">char</span> a[<span class="number">16</span>];</span><br><span class="line"><span class="type">char</span> b[<span class="number">16</span>];</span><br><span class="line"><span class="type">char</span> c[<span class="number">32</span>];</span><br><span class="line"><span class="built_in">strncpy</span>(a, <span class="string">&quot;0123456789abcdef&quot;</span>, <span class="built_in">sizeof</span>(a));</span><br><span class="line"><span class="built_in">strncpy</span>(b, <span class="string">&quot;0123456789abcdef&quot;</span>, <span class="built_in">sizeof</span>(b));</span><br><span class="line"><span class="built_in">strncpy</span>(c, a, <span class="built_in">sizeof</span>(c));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="strncpy-函数"><a href="#strncpy-函数" class="headerlink" title="strncpy 函数"></a><strong><strong>strncpy 函数</strong></strong></h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">char</span> *<span class="title">strncpy</span><span class="params">(<span class="type">char</span> * restrict s1,</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="type">const</span> <span class="type">char</span> * restrict s2,</span></span></span><br><span class="line"><span class="params"><span class="function"><span class="type">size_t</span> n)</span></span>;</span><br></pre></td></tr></table></figure>

<p>从数组S2中复制不超过 <strong>n</strong> 个字符串 (空字符后的字符不会被复制) 到目标数组S1 *****中。</p>
<p>➔ *因此，如果第一个数组S2中的前n个字符中不存在空字符，那么其结果字符串将不会是以空字符结尾的。</p>
<h2 id="字符串截断"><a href="#字符串截断" class="headerlink" title="字符串截断"></a><strong><strong>字符串截断</strong></strong></h2><p>⚫<strong>一些限制字节数的函数通常用来防止缓冲区溢出漏洞</strong></p>
<p>➔ <strong>strncpy() 代替 strcpy()</strong></p>
<p>➔ <strong>fgets()代替 gets()</strong></p>
<p>➔ <strong>snprintf()代替 sprintf()</strong></p>
<p>⚫当目标字符数组的长度不足以容纳一个字符串的内容时，就会发生字符串截断</p>
<p>⚫字符串截断会丢失数据，有时也会导致软件漏洞</p>
<h2 id="数组写入越界"><a href="#数组写入越界" class="headerlink" title="数组写入越界"></a><strong><strong>数组写入越界</strong></strong></h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> *argv[])</span> </span>&#123;</span><br><span class="line"><span class="number">2.</span> <span class="type">int</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="number">3.</span> <span class="type">char</span> buff[<span class="number">128</span>];</span><br><span class="line"><span class="number">4.</span> <span class="type">char</span> *arg1 = argv[<span class="number">1</span>];</span><br><span class="line"><span class="number">5.</span> <span class="keyword">while</span> (arg1[i] != <span class="string">&#x27;\0&#x27;</span> ) &#123;</span><br><span class="line"><span class="number">6.</span> buff[i] = arg1[i];</span><br><span class="line"><span class="number">7.</span> i++;</span><br><span class="line"><span class="number">8.</span> &#125;</span><br><span class="line"><span class="number">9.</span> buff[i] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line"><span class="number">10.</span> <span class="built_in">printf</span>(<span class="string">&quot;buff = %s\n&quot;</span>, buff);</span><br><span class="line"><span class="number">11.</span> &#125;</span><br></pre></td></tr></table></figure>

<h2 id="程序栈"><a href="#程序栈" class="headerlink" title="程序栈"></a><strong><strong>程序栈</strong></strong></h2><p>⚫栈（ 栈 ）通过存储下列内容来追踪程序的执行和状态。<br>➢ 调用函数的返回地址<br>➢ 函数参数<br>➢ 局部 (临时）变量<br>⚫在下列情况下栈需要被修改<br>➢ 在函数调用期间<br>➢ 函数初始化期间<br>➢ 从子例程返回时</p>
<h3 id="栈粉碎"><a href="#栈粉碎" class="headerlink" title="栈粉碎"></a><strong><strong>栈粉碎</strong></strong></h3><p>⚫堆栈支持嵌套调用</p>
<p>⚫帧指由函数调用引发的压入栈的数据。</p>
<p>⚫栈用于存储</p>
<p>➔ 调用函数的返回地址</p>
<p>➔ 子例程的实际参数</p>
<p>➔ 局部（自动）变量</p>
<p>⚫当前帧的地址被存储到帧或者基址寄存器中(英特尔架构中的EBP)</p>
<p>⚫帧指针在栈中是一个定点的引用。</p>
<p>⚫下列情况出现时，栈要要被修改</p>
<p>➔ 子例程调用</p>
<p>➔ 子例程初始化</p>
<p>➔ 从子例程返回</p>
<p><strong>EIP：扩展指令指针  ESP: 扩展栈指针  EBP:扩展基指针</strong></p>
<h2 id="缓冲区溢出"><a href="#缓冲区溢出" class="headerlink" title="缓冲区溢出"></a><strong><strong>缓冲区溢出</strong></strong></h2><p>当向为某特定数据结构分配的内存空间边界之外写入数据时， 就会发生缓冲区溢出。</p>
<p>➔当缓冲区溢出覆写分配给执行栈内存中的数据时，就会导致栈粉碎</p>
<p>➔成功的利用这个漏洞能够覆写栈返回地址，从而在目标机器中执行任意代码。</p>
<h2 id="代码注入"><a href="#代码注入" class="headerlink" title="代码注入"></a><strong><strong>代码注入</strong></strong></h2><p>⚫攻击者创建一个恶意参数</p>
<p>➔一个蓄意构造的字符串，其中包含一个指向某些恶意代码的指针，该代码也由攻击者提供。</p>
<p>⚫当函数返回时，控制就被转移到了那段恶意代码。</p>
<p>➔注入的代码就会以与该有漏洞的程序相同的权限运行</p>
<p>➔攻击者通常都以“以root或其他较高权限运行”的程序为目标</p>
<p>⚫恶意参数的目的是把控制权转移给恶意代码</p>
<p>➔ 可能包含在恶意参数 (如本实例)中</p>
<p>➔ 可能在一个有效的输入操作期间注入恶意代码</p>
<p>➔ 恶意代码可以执行以其他任何形式编程所能执行的功能，</p>
<p>不过它们通常只是简单地在受害机器上开一个远程<strong>。</strong></p>
<h2 id="弧注入-return-into-libc"><a href="#弧注入-return-into-libc" class="headerlink" title="弧注入 (return-into-libc)"></a><strong><strong>弧注入 (return-into-libc)</strong></strong></h2><p>弧注入将控制转移到已经存在于程序内存空间中的代码中</p>
<p>➔ 弧注入的利用方式是在程序的控制流“团”中插入一段新的“弧’（表示控制流转移），而不是进行代码注入。</p>
<p>➔ 可以安装一个已有函数的地址（如system() 或exec ()，用于执行已存在于本地系统上的程序</p>
<p>➔ 更复杂的攻击可能会使用这种技术</p>
<h3 id="缓解措施"><a href="#缓解措施" class="headerlink" title="缓解措施"></a><strong><strong>缓解措施</strong></strong></h3><p>⚫缓解措施包括：</p>
<p>➔预防缓冲区溢出</p>
<p>➔侦测缓冲区溢出并安全地恢复，使得漏洞利用的企图无法得逞。</p>
<p>⚫防范策略</p>
<p>➔静态分配空间</p>
<p>➔动态分配空间</p>
<h3 id="静态方法-静态分配缓冲区"><a href="#静态方法-静态分配缓冲区" class="headerlink" title="静态方法  静态分配缓冲区"></a><strong>静态方法  静态分配缓冲区</strong></h3><p>假设一个固定大小的缓冲区</p>
<p>➔在缓冲区满了以后，不可能添加再数据</p>
<p>➔因为静态的方法丢弃了超出的数据，所以实际的程序数据会丢失。</p>
<p>➔因此，生成的字符串必须被充分验证</p>
<p><strong>输入验证</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> <span class="function"><span class="type">int</span> <span class="title">myfunc</span><span class="params">(<span class="type">const</span> <span class="type">char</span> *arg)</span> </span>&#123;</span><br><span class="line"><span class="number">2.</span> <span class="type">char</span> buff[<span class="number">100</span>];</span><br><span class="line"><span class="number">3.</span> <span class="keyword">if</span> (<span class="built_in">strlen</span>(arg) &gt;= <span class="built_in">sizeof</span>(buff)) &#123;</span><br><span class="line"><span class="number">4.</span> <span class="built_in">abort</span>();</span><br><span class="line"><span class="number">5.</span> &#125;</span><br><span class="line"><span class="number">6.</span> &#125;</span><br></pre></td></tr></table></figure>

<p><strong>strlcpy() 和 strlcat()</strong></p>
<p>采用一个更不容易出错的方式来复制和链接</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">size_t</span> <span class="title">strlcpy</span><span class="params">(<span class="type">char</span> *dst,<span class="type">const</span> <span class="type">char</span> *src, <span class="type">size_t</span> size)</span></span>;</span><br><span class="line"><span class="function"><span class="type">size_t</span> <span class="title">strlcat</span><span class="params">(<span class="type">char</span> *dst,<span class="type">const</span> <span class="type">char</span> *src, <span class="type">size_t</span> size)</span></span>;</span><br></pre></td></tr></table></figure>

<p><strong>strlcpy()</strong> 从<strong>src</strong>复制空结尾的字符串到<strong>dst</strong> (直到<strong>size</strong> 大小的字符)。</p>
<p><strong>strlcat()</strong> 函数把非空结尾的字符串<strong>src</strong> 连接到<strong>dst</strong>末尾 (不超过<strong>size</strong> 的字符都能够连接到dst末尾)</p>
<p>两个函数都确保目标字符串对所有非零长度的缓冲区来说都是<br>非空结尾的。</p>
<p><strong><strong>ISO&#x2F;IEC “Security” TR 24731</strong></strong></p>
<p>➔strcpy_s() 代替strcpy()</p>
<p>➔strcat_s()代替strcat()</p>
<p>➔strncpy_s()代替strncpy()</p>
<p>➔strncat_s()代替strncat()</p>
<h3 id="strcpy-s-函数"><a href="#strcpy-s-函数" class="headerlink" title="strcpy_s() 函数"></a><strong><strong>strcpy_s() 函数</strong></strong></h3><p>把字符从源字符串复制到目标字符数组，直到并包括终止null字<br>符。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">errno_t</span> <span class="title">strcpy_s</span><span class="params">(<span class="type">char</span> * restrict s1,<span class="type">rsize_t</span> s1max,<span class="type">const</span> <span class="type">char</span> * restrict s2)</span></span>;</span><br></pre></td></tr></table></figure>

<h2 id="动态方法-动态地分配缓冲区"><a href="#动态方法-动态地分配缓冲区" class="headerlink" title="动态方法  动态地分配缓冲区"></a><strong>动态方法  动态地分配缓冲区</strong></h2><p>⚫动态分配的缓冲区需要动态调整额外的内存。</p>
<p>⚫动态方法更好，而且不丢弃多余的数据。</p>
<p>⚫主要缺点是,如果输入被限制，则可能</p>
<p>➔耗尽机器内存</p>
<p>➔结果导致拒绝服务攻击</p>
<h3 id="防范策略"><a href="#防范策略" class="headerlink" title="防范策略"></a><strong><strong>防范策略</strong></strong></h3><p>为C提供丰富的字符串操作库，</p>
<p>➔ 拥有安全的语义</p>
<p>➔ 与遗留的库代码互操作</p>
<p>➔ 使用一种动态分配的方式，可以在需要时自动调整字符串的大小。</p>
<h3 id="safestr-t-类型"><a href="#safestr-t-类型" class="headerlink" title="safestr_t 类型"></a><strong><strong>safestr_t 类型</strong></strong></h3><p>safestr_t类型与char<em>是兼容的，并且可以将safestr_t转型为char</em>当作<br>C风格字符使用。<br> safestr_t类型保存了由该指针所引用的内存部分的说明信息（例如，<br>实际长度和分配的长度），保存子指针所指向的内存之前</p>
<p>⚫管理动态字符串</p>
<p>➔ 分配缓冲区</p>
<p>➔ 如果需要额外的内存，则重新调整内存大小</p>
<p>⚫管理字符串操作，以确保</p>
<p>➔ 字符串操作没有导致缓冲区溢出</p>
<p>➔ 数据没有丢失</p>
<p>➔ 字符串正常终止(字符串可能是也可能不是内部空结尾)</p>
<p>⚫缺点</p>
<p>➔ 无限制地消耗内存，可能导致拒绝服务攻击</p>
<p>➔ 性能开销</p>
<h1 id="第四讲-软件安全漏洞基础"><a href="#第四讲-软件安全漏洞基础" class="headerlink" title="第四讲 软件安全漏洞基础"></a><strong><strong>第四讲 软件安全漏洞基础</strong></strong></h1><h2 id="软件漏洞简介"><a href="#软件漏洞简介" class="headerlink" title="软件漏洞简介"></a><strong><strong>软件漏洞简介</strong></strong></h2><p>在形形色色的软件逻辑缺陷中，有一部分如果被利用能够引起非常严重的后果。</p>
<p>例如:SQL注入,跨站脚本,缓冲区溢出</p>
<p>我们通常把这类能够引起软件做一些“超出设计范围的事情”的bug称为漏洞</p>
<table>
<thead>
<tr>
<th></th>
<th>含义</th>
<th>例子</th>
</tr>
</thead>
<tbody><tr>
<td>BUG</td>
<td>功能性逻辑缺陷，影响软件的正常功能</td>
<td>执行结果错误、图标显示错误等</td>
</tr>
<tr>
<td>漏洞</td>
<td>安全性逻辑缺陷，通常情况下不影响软件的正常功能，但被攻击者成功利用后，有可能引起软件去执行额外的恶意代码</td>
<td>软件缓冲区溢出漏洞、网站的跨站脚本漏洞(XSS)、SQL注入漏洞等</td>
</tr>
</tbody></table>
<h3 id="典型的软件漏洞"><a href="#典型的软件漏洞" class="headerlink" title="典型的软件漏洞"></a><strong><strong>典型的软件漏洞</strong></strong></h3><p>缓冲区溢出漏洞：它发生的原理是，由于用户处理用户数据时使用了不限边界的拷贝，导致程序内部一些关键数据被覆盖，引发了安全问题，严重的缓冲区溢出漏洞会使得程序被利用而安装上木马或病毒</p>
<p>整数溢出漏洞：对于有符号的16位整数来说，它的最大值就是0x7fff，也就是十进制的32767，当赋值给一个整数的值为其最大值时，如果此时再加上1，就会发生整数型的溢出。</p>
<p>格式化字符串漏洞：格式化字符串漏洞是由于程序的数据输出函数中对输出数据的格式解析不当而发生的。</p>
<p><strong>SQL注入漏洞：</strong>通过控制传递给软件数据库操作语句 的关键变量来获得恶意控制软件数据库、获取有用信息或者制造恶意破坏的，甚至是控制用户计算机系统的漏洞，就成为”SQL注入漏洞”。</p>
<h3 id="软件漏洞的危害"><a href="#软件漏洞的危害" class="headerlink" title="软件漏洞的危害"></a><strong><strong>软件漏洞的危害</strong></strong></h3><p>无法正常使用,引发恶性事件,关键数据丢失,秘密信息泄漏,被安装木马病毒</p>
<h3 id="安全漏洞出现的原因"><a href="#安全漏洞出现的原因" class="headerlink" title="安全漏洞出现的原因"></a><strong><strong>安全漏洞出现的原因</strong></strong></h3><p>小作坊式的软件开发、赶进度带来的弊端、被轻视的软件安全测试、淡薄的安全思想、不完善的安全维护、</p>
<h2 id="漏洞挖掘、分析、利用简介"><a href="#漏洞挖掘、分析、利用简介" class="headerlink" title="漏洞挖掘、分析、利用简介"></a><strong><strong>漏洞挖掘、分析、利用简介</strong></strong></h2><p>⚫从技术角度讲，漏洞挖掘实际上是一种高级的测试(QA)。</p>
<p>⚫学术界一直热衷于使用静态分析的方法寻找源代码中的漏洞；</p>
<p>⚫而在工程界，不管是安全专家还是攻击者，普遍采用的漏洞挖掘方法是Fuzz，这实际是一种“灰”盒测试。</p>
<p>⚫当fuzz捕捉到软件一个严重的异常时，当你想透过厂商公布的简单描述了解漏洞细节的时候，我们就需要具备一定的漏洞分析能力。一般情况下，我们需要调试二进制级别的程序。</p>
<h2 id="PE文件格式简介-1"><a href="#PE文件格式简介-1" class="headerlink" title="PE文件格式简介"></a><strong><strong>PE文件格式简介</strong></strong></h2><p>PE(Portable Executable)是Win32平台下可执行文件遵守的数据格式。常见的可执行文件(如“*.exe”文件和“*.dll”文件)都是典型的PE文件。</p>
<p>PE 文 件 格 式 把 可 执 行 文 件 分 成 若 干 个 数 据 节(section)，不通的资源被存放在不同的节中。一个典型的PE文件包含的节如下：</p>
<table>
<thead>
<tr>
<th>DOS头</th>
</tr>
</thead>
<tbody><tr>
<td>PE签名</td>
</tr>
<tr>
<td>PE头文件</td>
</tr>
<tr>
<td>PE可选头</td>
</tr>
<tr>
<td>节表</td>
</tr>
<tr>
<td>.idata节</td>
</tr>
<tr>
<td>.text节</td>
</tr>
<tr>
<td>.data节</td>
</tr>
</tbody></table>
<h2 id="虚拟内存相关知识"><a href="#虚拟内存相关知识" class="headerlink" title="虚拟内存相关知识"></a><strong>虚拟内存相关知识</strong></h2><h3 id="PE文件与虚拟内存之间的映射-1"><a href="#PE文件与虚拟内存之间的映射-1" class="headerlink" title="PE文件与虚拟内存之间的映射"></a><strong>PE文件与虚拟内存之间的映射</strong></h3><p>⚫ <strong>文件偏移地址(File Offset)</strong></p>
<p>➢数据在PE文件中的地址叫做文件偏移地址。这是文件在磁盘上存放时相对于文件开头的偏移。</p>
<p>⚫ <strong>装载基址(Image Base)</strong></p>
<p>➢PE装入内存时的基地址。默认情况下，EXE文件在内存中的基地址是0x00400000,DLL文件是0x10000000。这些位置可以通过修改编译选项更改</p>
<p>⚫ <strong>虚拟内存地址(Virtual Address,VA)</strong></p>
<p>➢PE文件中的指令被装入内存后的地址。</p>
<p>⚫ <strong>相对虚拟地址(Relative Virtual Address,RVA)</strong></p>
<p>➢相对虚拟地址是内存地址相对于映射基址的偏移量。</p>
<p>➔ <strong>虚拟内存地址、映射基址、相对虚拟内存地址三</strong>者有如下关系 VA&#x3D;Image Base + RVA</p>
<h1 id="第五讲-漏洞利用技术"><a href="#第五讲-漏洞利用技术" class="headerlink" title="第五讲 漏洞利用技术"></a><strong><strong>第五讲 漏洞利用技术</strong></strong></h1><h2 id="shellcode概述"><a href="#shellcode概述" class="headerlink" title="shellcode概述"></a><strong><strong>shellcode概述</strong></strong></h2><h3 id="淹没返回地址"><a href="#淹没返回地址" class="headerlink" title="淹没返回地址"></a><strong><strong>淹没返回地址</strong></strong></h3><p>buffer[0-3]<br>buffer[4-7]<br>authenticated          左侧是变量的 排列顺序图<br>EBP<br>返回地址<br>观察一下我们发现我们只需要先放置16个字符串，然后接下来<br>的4个字节就能够淹没返回地址，达到控制返回地址的目的</p>
<h3 id="栈帧移位与jmp-esp"><a href="#栈帧移位与jmp-esp" class="headerlink" title="栈帧移位与jmp esp"></a><strong><strong>栈帧移位与jmp esp</strong></strong></h3><p>一般情况下，ESP寄存器中的地址总是指向系统栈中，且不会被溢出的数据破坏。函数返回时，ESP所指的位置恰好是我们所淹没的返回地址的下一个位置</p>
<h3 id="获取“跳板”的地址"><a href="#获取“跳板”的地址" class="headerlink" title="获取“跳板”的地址"></a><strong><strong>获取“跳板”的地址</strong></strong></h3><p>在利用跳板之前，我们必须在进程空间中找到一条jmp esp指令的地址作为“跳板”。除了PE文件的代码被读入内存空间，一些经常被用到的动态链接库也将会一同被映射到内存 。 其 中 ， 注 入kernel32.dll,user32.dll之类的动态链接库几乎会被所有的进程加载，且加载基址始终相同。</p>
<h2 id="缓冲区的组织"><a href="#缓冲区的组织" class="headerlink" title="缓冲区的组织"></a><strong><strong>缓冲区的组织</strong></strong></h2><p>填充物:可以是任何值，但是一般用NOP指令对应的0x90来进行填充，这样只要能跳进填充区，处理器最终也能顺序执行到shellcode。</p>
<p>淹没返回地址的数据：可以是跳转指令的地址，shellcode的起始地址，或者近似的shellcode地址（跳转进NOP填充区）</p>
<p>shellcode:可执行的机器代码。</p>
<h1 id="第六讲-漏洞挖掘与模糊测试"><a href="#第六讲-漏洞挖掘与模糊测试" class="headerlink" title="第六讲 漏洞挖掘与模糊测试"></a><strong><strong>第六讲 漏洞挖掘与模糊测试</strong></strong></h1><h2 id="漏洞挖掘技术简介"><a href="#漏洞挖掘技术简介" class="headerlink" title="漏洞挖掘技术简介"></a><strong><strong>漏洞挖掘技术简介</strong></strong></h2><p>工业界目前普遍采用的是进行Fuzz测试，与基于功能性的测试有所不同，Fuzz的主要目的是”崩溃crash”,”中断break”,”销毁destroy”。</p>
<p>Fuzz的测试用例往往是带有攻击性的畸形数据，用以触发各种类型的漏洞。<br>我们可以把Fuzz理解成为一种能自动进行”rough attack”尝试的工具。之所以说它是”rough attack”,是因为Fuzz往往可以触发一个缓冲区溢出的漏洞，但却不能实现有效的exploit。<br>测试人员需要实时地捕捉目标程序抛出的异常、发生的崩溃和寄存器等信息，综合判断这些错误是不是真正的可利用漏洞</p>
<h3 id="动态测试技术与静态代码审计的对比"><a href="#动态测试技术与静态代码审计的对比" class="headerlink" title="动态测试技术与静态代码审计的对比"></a><strong>动态测试技术与静态代码审计的对比</strong></h3><table>
<thead>
<tr>
<th></th>
<th>动态测试技术</th>
<th>静态代码审计</th>
</tr>
</thead>
<tbody><tr>
<td>主要技术</td>
<td>Fuzz等黑盒测试</td>
<td>数据流分析、类型验证系统、边界检验系统、状态机系统等</td>
</tr>
<tr>
<td>主要应用人群</td>
<td>攻击者</td>
<td>学者、QA工程师</td>
</tr>
<tr>
<td>优点</td>
<td>快捷，准确</td>
<td>检测出的漏洞数量多</td>
</tr>
<tr>
<td>缺点</td>
<td>不能发现系统里全部（或者大部分）漏洞</td>
<td>实现静态代码分析工具相当困难</td>
</tr>
</tbody></table>
<h3 id="Fuzz"><a href="#Fuzz" class="headerlink" title="Fuzz"></a>Fuzz</h3><p>Fuzz的测试用例往往是带有攻击性的畸形数据，用以触发各种类型的漏洞。<br>我们可以把Fuzz理解成为一种能自动进行”rough attack”尝试的工具。之所以说它是”rough attack”,是因为Fuzz往往可以触发一个缓冲区溢出的漏洞，但却不能实现有效的exploit。</p>
<p>Fuzz的测试优点是很少出现误报，能够迅速地找到真正的漏洞；缺点是Fuzz永远不能保证系统里已经没漏洞。</p>
<h2 id="文件类型漏洞挖掘—文件格式Fuzz的基本方法"><a href="#文件类型漏洞挖掘—文件格式Fuzz的基本方法" class="headerlink" title="文件类型漏洞挖掘—文件格式Fuzz的基本方法"></a><strong>文件类型漏洞挖掘—文件格式Fuzz的基本方法</strong></h2><p>不管IE还是OFFICE，它们都有一个共同点，那就是用文件作为程序的主要输入。从本质上来说，这些软件都是按照事先约定好的数据结构对文件中不同的数据域进行解析，以决定用什么颜色、在什么位置显示这些数据。<br>假如我们习惯了这样的思维，也就是假设他们所使用的文件是严格遵守软件规定的数据格式的。因为用Word生成的doc文件一般不会存在什么非法数据。<br>文件格式Fuzz就是利用这种“畸形文件”测试软件的方法。我们可以在网上找到很多FileFuzz的工具。</p>
<p><strong>一个File Fuzz工具通常包括以下几个步骤：</strong></p>
<p>(1)以一个正常的文件模板作为基础，按照一定规则产生一批畸形文件。<br>(2)将畸形文件逐一送入软件进行解析，并监视软件是否会抛出异常<br>(3)记录软件产生的错误信息，如寄存器状态、栈状态等。<br>(4)用日志或其他UI形式向测试人员展示异常信息，以进一步鉴定这些错误是否能被利用</p>
<blockquote>
<p><strong>Blind Fuzz</strong>即通常所说的“盲测”，就是在随机位置插入随机的数据以生成畸形文件。然而现代软件往往使用非常复杂的私有数据结构。</p>
</blockquote>
<blockquote>
<p>针对Blind Fuzz的不足，<strong>Smart Fuzz</strong>被越来越多地提出和应用。通常Smart Fuzz包括三方面的特征：<br>面向逻辑(Logic Oriented Fuzzing)<br>面向数据类型(Data Type Oriented Fuzzing)<br>基于样本(Sample Based Fuzzing)</p>
</blockquote>
<p><strong>面向数据类型测试：</strong>测试中可以生成的数据通常包括以下几种类型。</p>
<p>1）算术型：包括以HEX、ASCII、Unicode、Raw格式存在的各种数值。</p>
<p>2）指针型：包括Null指针、合法&#x2F;非法的内存指针等。</p>
<p>3）字符串型：包括超长字符串、缺少终止符(0x00)的字符串等。</p>
<p>4）特殊字符：包括#，@，’，&lt;,&gt;,&#x2F;,,..&#x2F;等等。</p>
<h1 id="第七讲-指针安全"><a href="#第七讲-指针安全" class="headerlink" title="第七讲 指针安全"></a><strong><strong>第七讲 指针安全</strong></strong></h1><h2 id="缓冲区溢出覆写指针条件："><a href="#缓冲区溢出覆写指针条件：" class="headerlink" title="缓冲区溢出覆写指针条件："></a>缓冲区溢出覆写指针条件：</h2><p>➔ 缓冲区与目标指针必须分配在同一个段内</p>
<p>➔ 缓冲区必须位于比目标指针更低的内存地址处</p>
<p>➔ 该缓冲区必须是界限不充分的，因此容易被缓冲区溢出利用</p>
<h2 id="虚函数攻击"><a href="#虚函数攻击" class="headerlink" title="虚函数攻击"></a><strong><strong>虚函数攻击</strong></strong></h2><p>多态是面向对象的一个重要特性，在C++中，这个特性主要靠对虚函数的动态调用来实现。</p>
<p>在仅仅关注漏洞利用的前提下，我们可以简单地把虚函数和虚表理解为一下几个要点。</p>
<p>1）C++类的成员函数在声明时，若使用关键字virtual进行修饰，则被称为虚函数</p>
<p>2）一个类中可能有很多个虚函数。</p>
<p>3）虚函数的入口地址被统一保存在虚表(Vtable)中。</p>
<p>4）对象在使用虚函数时，先通过虚表指针找到虚表，然后从虚表中取出最终的函数入口地址进行调用。</p>
<p>5）虚表指针保存在对象的内存空间中，紧接着虚表指针的是其他成员变量。</p>
<p>6）虚函数只有通过对象指针的引用才能显示出其动态调用的特性</p>
<h2 id="SEH攻击"><a href="#SEH攻击" class="headerlink" title="SEH攻击"></a><strong>SEH攻击</strong></h2><p>1）S.E.H结构体存放在系统栈中。</p>
<p>2）当线程初始化时，会自动向栈中安装一个S.E.H，作为线程默认的异常处理。</p>
<p>3）如果程序源代码中使用了__try{}__except{}或者Assert宏等异常处理机制，编译器将最终通过向当前函数栈帧中安装一个S.E.H来实现异常处理。</p>
<p>4）栈中一般会同时存在多个S.E.H</p>
<p>5）栈中的多个S.E.H通过链表指针在栈内由栈顶向栈底串成单向链表，位于链表最顶端的S.E.H通过T.E.B(线程环境块)0字节偏移处的指针标识。</p>
<p>6）当异常发生时，操作系统会中断程序，并首先从T.E.B的0字节偏移处取出距离栈顶最近的S.E.H，使用异常处理函数句柄所指向的代码来处理异常。</p>
<p>7）当离“事故现场”最近的异常处理函数运行失败时，将顺着S.E.H链表依次尝试其他的异常处理函数。</p>
<p>8）如果程序安装的所有异常处理函数都不能处理，系统将采用默认的异常处理函数。通常，这个函数会弹出一个对话框，然后强制关闭程序</p>
<blockquote>
<p>首先，S.E.H存放在栈内，我们学过的栈溢出漏洞可能会派上用场。<br>其次，我们可以精心制造出溢出数据来把S.E.H的异常处理的函数地址替换为shellcode的起始地址。<br>再次，溢出后错误的栈帧或堆块数据往往会触发异常，或者我们能查到哪些能触发异常的片段。<br>最后，当Windows开始处理溢出后的异常时，会把hellcode当作异常函数来处理异常。</p>
</blockquote>
<h1 id="第八讲-格式化输出"><a href="#第八讲-格式化输出" class="headerlink" title="第八讲 格式化输出"></a><strong>第八讲 格式化输出</strong></h1><p><strong>格式化输出函数参数由一个格式字符串和可变数目的参数构成</strong></p>
<p>➔格式化字符串提供了一组可以由格式化输出函数解释执行的指令<br>➔用户可以通过控制格式字符串的内容来控制格式化输出函数的执行</p>
<p><strong>变参函数在C语言中实现的局限性导致格式化输出函数的使用中容易产生漏洞！</strong></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://zhangyuanhe.top">Charmes</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://zhangyuanhe.top/2024/01/15/BUPT_note/Notes%20on%20software%20security/">https://zhangyuanhe.top/2024/01/15/BUPT_note/Notes%20on%20software%20security/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="null" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://zhangyuanhe.top" target="_blank">ZYH's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%8C%97%E9%82%AE%E4%BF%A1%E5%AE%89/">北邮信安</a><a class="post-meta__tags" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></div><div class="post_share"><div class="social-share" data-image="https://zyhblog-1318929733.cos.ap-beijing.myqcloud.com/tags1-1690700892780-1.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2024/01/14/BUPT_note/Notes%20on%20Information%20System%20Security/" title="信息系统安全课程笔记"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyhblog-1318929733.cos.ap-beijing.myqcloud.com/tags1-1690700892780-1.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">信息系统安全课程笔记</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2024/01/09/BUPT_note/Notes%20on%20Algorithm%20Design%20and%20Analysis/" title="算法设计与分析课程笔记"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyhblog-1318929733.cos.ap-beijing.myqcloud.com/tags1-1690700892780-1.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-09</div><div class="title">算法设计与分析课程笔记</div></div></a></div><div><a href="/2024/01/11/BUPT_note/Notes%20on%20Compilation%20principle/" title="编译原理与技术课程笔记"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyhblog-1318929733.cos.ap-beijing.myqcloud.com/tags1-1690700892780-1.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-11</div><div class="title">编译原理与技术课程笔记</div></div></a></div><div><a href="/2023/07/31/BUPT_note/BUPT_SCSS_introduce/" title="北邮网安大类课程介绍（21级）"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyhblog-1318929733.cos.ap-beijing.myqcloud.com/tags1-1690700892780-1.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-07-31</div><div class="title">北邮网安大类课程介绍（21级）</div></div></a></div><div><a href="/2024/01/10/BUPT_note/Notes%20on%20Complex%20network/" title="复杂网络课程笔记"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyhblog-1318929733.cos.ap-beijing.myqcloud.com/tags1-1690700892780-1.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-10</div><div class="title">复杂网络课程笔记</div></div></a></div><div><a href="/2024/01/14/BUPT_note/Notes%20on%20Information%20System%20Security/" title="信息系统安全课程笔记"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyhblog-1318929733.cos.ap-beijing.myqcloud.com/tags1-1690700892780-1.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-14</div><div class="title">信息系统安全课程笔记</div></div></a></div><div><a href="/2024/01/10/BUPT_note/Notes%20on%20Information%20Theory%20and%20Coding/" title="信息论与编码课程笔记"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyhblog-1318929733.cos.ap-beijing.myqcloud.com/tags1-1690700892780-1.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-01-10</div><div class="title">信息论与编码课程笔记</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="card-info-avatar"> <div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/favicon1.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-status-box"><div class="author-status"><g-emoji class="g-emoji" alias="palm_tree" fallback-src="https://lskypro.acozycotage.net/LightPicture/2022/12/fe1dc0402e623096.jpg">🐟</g-emoji><span>认真摸鱼中</span></div></div></div><div class="author-info__name">Charmes</div><div class="author-info__description">敏于思 慎于行</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">69</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">18</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">14</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/shuita2333"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/shuita2333" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:603747072@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="https://gitee.com/bank-beaver" target="_blank" title="Gitee"><i class="fab fa-git-square" style="color: #d5382a;"></i></a><a class="social-icon" href="https://zyhblog-1318929733.cos.ap-beijing.myqcloud.com/image-20230729200147469.png" target="_blank" title="wechat"><i class="fab fa-weixin" style="color: #3CB371;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的博客━(*｀∀´*)ノ      有任何事宜可以在文末留言，链接过期可以私信我，我会尽快更新</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8-%E5%BC%A0%E6%B7%BC"><span class="toc-number">1.</span> <span class="toc-text">软件安全 张淼</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">2.</span> <span class="toc-text">概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%8E%B0%E7%8A%B6"><span class="toc-number">2.0.1.</span> <span class="toc-text">信息安全现状</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81"><span class="toc-number">2.0.2.</span> <span class="toc-text">信息安全威胁</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E7%9A%84%E5%8E%9F%E5%9B%A0%E5%92%8C%E6%A0%B9%E6%BA%90"><span class="toc-number">2.1.</span> <span class="toc-text">问题的原因和根源</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E9%97%AE%E9%A2%98%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-number">2.1.1.</span> <span class="toc-text">软件问题的原因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%96%B0%E7%9A%84%E9%9C%80%E6%B1%82%E4%B8%8E%E4%BC%A0%E7%BB%9F%E5%AE%89%E5%85%A8%E6%8A%80%E6%9C%AF%E7%9A%84%E4%B8%8D%E8%B6%B3"><span class="toc-number">2.1.2.</span> <span class="toc-text">新的需求与传统安全技术的不足</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E5%9F%BA%E7%A1%80"><span class="toc-number">3.</span> <span class="toc-text">缓冲区溢出基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E6%A6%82%E8%BF%B0%EF%BC%8D%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E5%8E%9F%E7%90%86%E7%AE%80%E4%BB%8B"><span class="toc-number">3.1.</span> <span class="toc-text">缓冲区溢出概述－缓冲区溢出原理简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PE%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E7%AE%80%E4%BB%8B"><span class="toc-number">3.2.</span> <span class="toc-text">PE文件格式简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86%E2%80%94%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%80%E4%BB%8B"><span class="toc-number">3.3.</span> <span class="toc-text">虚拟内存相关知识—虚拟内存简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PE%E6%96%87%E4%BB%B6%E4%B8%8E%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E4%B9%8B%E9%97%B4%E7%9A%84%E6%98%A0%E5%B0%84"><span class="toc-number">3.4.</span> <span class="toc-text">PE文件与虚拟内存之间的映射</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">3.4.1.</span> <span class="toc-text">概念</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E6%A0%88%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86%E2%80%94%E5%86%85%E5%AD%98%E7%9A%84%E4%B8%8D%E5%90%8C%E7%94%A8%E9%80%94"><span class="toc-number">3.5.</span> <span class="toc-text">系统栈的工作原理—内存的不同用途</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">3.5.1.</span> <span class="toc-text">寄存器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%88%E4%B8%8E%E7%B3%BB%E7%BB%9F%E6%A0%88"><span class="toc-number">3.5.2.</span> <span class="toc-text">栈与系统栈</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%84%E5%AD%98%E5%99%A8%E4%B8%8E%E5%87%BD%E6%95%B0%E6%A0%88%E5%B8%A7"><span class="toc-number">3.6.</span> <span class="toc-text">寄存器与函数栈帧</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E8%B0%83%E7%94%A8%E7%BA%A6%E5%AE%9A%E4%B8%8E%E7%9B%B8%E5%85%B3%E6%8C%87%E4%BB%A4"><span class="toc-number">3.7.</span> <span class="toc-text">函数调用约定与相关指令</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E8%AE%B2-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AE%89%E5%85%A8"><span class="toc-number">4.</span> <span class="toc-text">第三讲 字符串安全</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#C-%E9%A3%8E%E6%A0%BC%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">4.1.</span> <span class="toc-text">C-风格的字符串</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C-%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="toc-number">4.2.</span> <span class="toc-text">C++ 字符串</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%93%8D%E4%BD%9C%E9%94%99%E8%AF%AF"><span class="toc-number">4.3.</span> <span class="toc-text">常见的字符串操作错误</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%97%A0%E8%BE%B9%E7%95%8C%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%8D%E5%88%B6"><span class="toc-number">4.4.</span> <span class="toc-text">无边界字符串复制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">4.4.1.</span> <span class="toc-text">简单的解决方案</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#C-%E6%97%A0%E7%95%8C%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%A4%8D%E5%88%B6"><span class="toc-number">4.5.</span> <span class="toc-text">C++无界字符串复制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-1"><span class="toc-number">4.5.1.</span> <span class="toc-text">简单的解决方案</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A9%BA%E7%BB%93%E5%B0%BE%E9%94%99%E8%AF%AF"><span class="toc-number">4.6.</span> <span class="toc-text">空结尾错误</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#strncpy-%E5%87%BD%E6%95%B0"><span class="toc-number">4.6.1.</span> <span class="toc-text">strncpy 函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%88%AA%E6%96%AD"><span class="toc-number">4.7.</span> <span class="toc-text">字符串截断</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E5%86%99%E5%85%A5%E8%B6%8A%E7%95%8C"><span class="toc-number">4.8.</span> <span class="toc-text">数组写入越界</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A8%8B%E5%BA%8F%E6%A0%88"><span class="toc-number">4.9.</span> <span class="toc-text">程序栈</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%88%E7%B2%89%E7%A2%8E"><span class="toc-number">4.9.1.</span> <span class="toc-text">栈粉碎</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA"><span class="toc-number">4.10.</span> <span class="toc-text">缓冲区溢出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E6%B3%A8%E5%85%A5"><span class="toc-number">4.11.</span> <span class="toc-text">代码注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%A7%E6%B3%A8%E5%85%A5-return-into-libc"><span class="toc-number">4.12.</span> <span class="toc-text">弧注入 (return-into-libc)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E8%A7%A3%E6%8E%AA%E6%96%BD"><span class="toc-number">4.12.1.</span> <span class="toc-text">缓解措施</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E6%96%B9%E6%B3%95-%E9%9D%99%E6%80%81%E5%88%86%E9%85%8D%E7%BC%93%E5%86%B2%E5%8C%BA"><span class="toc-number">4.12.2.</span> <span class="toc-text">静态方法  静态分配缓冲区</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#strcpy-s-%E5%87%BD%E6%95%B0"><span class="toc-number">4.12.3.</span> <span class="toc-text">strcpy_s() 函数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E6%96%B9%E6%B3%95-%E5%8A%A8%E6%80%81%E5%9C%B0%E5%88%86%E9%85%8D%E7%BC%93%E5%86%B2%E5%8C%BA"><span class="toc-number">4.13.</span> <span class="toc-text">动态方法  动态地分配缓冲区</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E8%8C%83%E7%AD%96%E7%95%A5"><span class="toc-number">4.13.1.</span> <span class="toc-text">防范策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#safestr-t-%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.13.2.</span> <span class="toc-text">safestr_t 类型</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E8%AE%B2-%E8%BD%AF%E4%BB%B6%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E%E5%9F%BA%E7%A1%80"><span class="toc-number">5.</span> <span class="toc-text">第四讲 软件安全漏洞基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E7%AE%80%E4%BB%8B"><span class="toc-number">5.1.</span> <span class="toc-text">软件漏洞简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B8%E5%9E%8B%E7%9A%84%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E"><span class="toc-number">5.1.1.</span> <span class="toc-text">典型的软件漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%8D%B1%E5%AE%B3"><span class="toc-number">5.1.2.</span> <span class="toc-text">软件漏洞的危害</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E6%BC%8F%E6%B4%9E%E5%87%BA%E7%8E%B0%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="toc-number">5.1.3.</span> <span class="toc-text">安全漏洞出现的原因</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E3%80%81%E5%88%86%E6%9E%90%E3%80%81%E5%88%A9%E7%94%A8%E7%AE%80%E4%BB%8B"><span class="toc-number">5.2.</span> <span class="toc-text">漏洞挖掘、分析、利用简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PE%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8F%E7%AE%80%E4%BB%8B-1"><span class="toc-number">5.3.</span> <span class="toc-text">PE文件格式简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86"><span class="toc-number">5.4.</span> <span class="toc-text">虚拟内存相关知识</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PE%E6%96%87%E4%BB%B6%E4%B8%8E%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E4%B9%8B%E9%97%B4%E7%9A%84%E6%98%A0%E5%B0%84-1"><span class="toc-number">5.4.1.</span> <span class="toc-text">PE文件与虚拟内存之间的映射</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E8%AE%B2-%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8%E6%8A%80%E6%9C%AF"><span class="toc-number">6.</span> <span class="toc-text">第五讲 漏洞利用技术</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#shellcode%E6%A6%82%E8%BF%B0"><span class="toc-number">6.1.</span> <span class="toc-text">shellcode概述</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B7%B9%E6%B2%A1%E8%BF%94%E5%9B%9E%E5%9C%B0%E5%9D%80"><span class="toc-number">6.1.1.</span> <span class="toc-text">淹没返回地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A0%88%E5%B8%A7%E7%A7%BB%E4%BD%8D%E4%B8%8Ejmp-esp"><span class="toc-number">6.1.2.</span> <span class="toc-text">栈帧移位与jmp esp</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E2%80%9C%E8%B7%B3%E6%9D%BF%E2%80%9D%E7%9A%84%E5%9C%B0%E5%9D%80"><span class="toc-number">6.1.3.</span> <span class="toc-text">获取“跳板”的地址</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E7%9A%84%E7%BB%84%E7%BB%87"><span class="toc-number">6.2.</span> <span class="toc-text">缓冲区的组织</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%85%AD%E8%AE%B2-%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E4%B8%8E%E6%A8%A1%E7%B3%8A%E6%B5%8B%E8%AF%95"><span class="toc-number">7.</span> <span class="toc-text">第六讲 漏洞挖掘与模糊测试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E6%8A%80%E6%9C%AF%E7%AE%80%E4%BB%8B"><span class="toc-number">7.1.</span> <span class="toc-text">漏洞挖掘技术简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E6%B5%8B%E8%AF%95%E6%8A%80%E6%9C%AF%E4%B8%8E%E9%9D%99%E6%80%81%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="toc-number">7.1.1.</span> <span class="toc-text">动态测试技术与静态代码审计的对比</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fuzz"><span class="toc-number">7.1.2.</span> <span class="toc-text">Fuzz</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E7%B1%BB%E5%9E%8B%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E2%80%94%E6%96%87%E4%BB%B6%E6%A0%BC%E5%BC%8FFuzz%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%96%B9%E6%B3%95"><span class="toc-number">7.2.</span> <span class="toc-text">文件类型漏洞挖掘—文件格式Fuzz的基本方法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E4%B8%83%E8%AE%B2-%E6%8C%87%E9%92%88%E5%AE%89%E5%85%A8"><span class="toc-number">8.</span> <span class="toc-text">第七讲 指针安全</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E5%8C%BA%E6%BA%A2%E5%87%BA%E8%A6%86%E5%86%99%E6%8C%87%E9%92%88%E6%9D%A1%E4%BB%B6%EF%BC%9A"><span class="toc-number">8.1.</span> <span class="toc-text">缓冲区溢出覆写指针条件：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%99%9A%E5%87%BD%E6%95%B0%E6%94%BB%E5%87%BB"><span class="toc-number">8.2.</span> <span class="toc-text">虚函数攻击</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SEH%E6%94%BB%E5%87%BB"><span class="toc-number">8.3.</span> <span class="toc-text">SEH攻击</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%AC%AC%E5%85%AB%E8%AE%B2-%E6%A0%BC%E5%BC%8F%E5%8C%96%E8%BE%93%E5%87%BA"><span class="toc-number">9.</span> <span class="toc-text">第八讲 格式化输出</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/01/15/BUPT_note/Notes%20on%20software%20security/" title="软件安全课程笔记"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyhblog-1318929733.cos.ap-beijing.myqcloud.com/tags1-1690700892780-1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="软件安全课程笔记"/></a><div class="content"><a class="title" href="/2024/01/15/BUPT_note/Notes%20on%20software%20security/" title="软件安全课程笔记">软件安全课程笔记</a><time datetime="2024-01-15T13:00:00.000Z" title="发表于 2024-01-15 21:00:00">2024-01-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/14/BUPT_note/Notes%20on%20Information%20System%20Security/" title="信息系统安全课程笔记"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyhblog-1318929733.cos.ap-beijing.myqcloud.com/tags1-1690700892780-1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="信息系统安全课程笔记"/></a><div class="content"><a class="title" href="/2024/01/14/BUPT_note/Notes%20on%20Information%20System%20Security/" title="信息系统安全课程笔记">信息系统安全课程笔记</a><time datetime="2024-01-14T13:00:00.000Z" title="发表于 2024-01-14 21:00:00">2024-01-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/11/BUPT_note/Notes%20on%20Compilation%20principle/" title="编译原理与技术课程笔记"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyhblog-1318929733.cos.ap-beijing.myqcloud.com/tags1-1690700892780-1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="编译原理与技术课程笔记"/></a><div class="content"><a class="title" href="/2024/01/11/BUPT_note/Notes%20on%20Compilation%20principle/" title="编译原理与技术课程笔记">编译原理与技术课程笔记</a><time datetime="2024-01-11T13:00:00.000Z" title="发表于 2024-01-11 21:00:00">2024-01-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/10/BUPT_note/Notes%20on%20Complex%20network/" title="复杂网络课程笔记"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyhblog-1318929733.cos.ap-beijing.myqcloud.com/tags1-1690700892780-1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="复杂网络课程笔记"/></a><div class="content"><a class="title" href="/2024/01/10/BUPT_note/Notes%20on%20Complex%20network/" title="复杂网络课程笔记">复杂网络课程笔记</a><time datetime="2024-01-10T13:00:00.000Z" title="发表于 2024-01-10 21:00:00">2024-01-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/10/BUPT_note/Notes%20on%20Information%20Theory%20and%20Coding/" title="信息论与编码课程笔记"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyhblog-1318929733.cos.ap-beijing.myqcloud.com/tags1-1690700892780-1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="信息论与编码课程笔记"/></a><div class="content"><a class="title" href="/2024/01/10/BUPT_note/Notes%20on%20Information%20Theory%20and%20Coding/" title="信息论与编码课程笔记">信息论与编码课程笔记</a><time datetime="2024-01-10T13:00:00.000Z" title="发表于 2024-01-10 21:00:00">2024-01-10</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer-wrap"></div><div id="ft"><div class="ft-item-1"><div class="t-top"><div class="t-t-l"><p class="ft-t t-l-t">格言🧬</p><div class="bg-ad"><div>再看看那个光点，它就在这里，这是家园，这是我们 —— 你所爱的每一个人，你认识的一个人，你听说过的每一个人，曾经有过的每一个人，都在它上面度过他们的一生✨</div><div class="btn-xz-box"><a class="btn-xz" target="_blank" rel="noopener" href="https://stellarium.org/">点击开启星辰之旅</a></div></div></div><div class="t-t-r"><p class="ft-t t-l-t">猜你想看💡</p><ul class="ft-links"><li><a href="/link/">我的朋友</a></li><li> <a href="/about/">关于作者</a></li><li> <a href="/archives/">文章归档</a></li><li> <a href="/categories/">文章分类</a></li><li> <a href="/tags/">文章标签</a></li></ul></div></div></div><div class="ft-item-2"><p class="ft-t">推荐友链⌛</p><div class="ft-img-group"><div class="img-group-item"><a href="https://zhangyuanhe.top/" title="Charmes"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyhblog-1318929733.cos.ap-beijing.myqcloud.com/favicon1.png" alt=""/></a></div><div class="img-group-item"><a target="_blank" rel="noopener" href="https://liuruibin.com/" title="LRBlog"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lrblog-img-1304667442.file.myqcloud.com/method.jpg" alt=""/></a></div><div class="img-group-item"><a target="_blank" rel="noopener" href="https://akilar.top/" title="Akilarの糖果屋"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/6bf1ed05796db59c.jpg" alt=""/></a></div><div class="img-group-item"><a target="_blank" rel="noopener" href="http://www.azuredust.cc" title="de4dst4r blog"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://www.azuredust.cc/wp-content/themes/personalblogily/inc/starter_content/img/portrait.png" alt=""/></a></div></div></div></div><div class="copyright"><span><b>&copy;2023 - 2024</b></span><span><b>&nbsp;&nbsp;By Charmes</b></span></div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a><span class="footer-separator">|</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=/img/icp.png>
<a href="https://beian.miit.gov.cn/" target="_blank">京ICP备2023019220号-1</a></div><div id="workboard"></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><a class="icon-V hidden" onclick="switchNightMode()" title="浅色和深色模式转换"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button class="share" type="button" title="右键模式" onclick="changeMouseMode()"><i class="fas fa-mouse"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" href="javascript:rmf.scrollToTop();"><i class="fa fa-arrow-up"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa fa-copy"></i><span>复制</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();"><i class="fa fa-search"></i><span>百度搜索</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();"><i class="fa fa-link"></i><span>转到链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()"><i class="fa fa-copy"></i><span>粘贴</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="#post-comment"><i class="fas fa-comment"></i><span>空降评论</span></a><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()"><i class="fa fa-link"></i><span>复制本文地址</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>新窗口打开</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()"><i class="fa fa-link"></i><span>转到链接</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()"><i class="fa fa-download"></i><span>保存图片</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>在新窗口打开</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制图片链接</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:randomPost()"><i class="fa fa-paper-plane"></i><span>随便逛逛</span></a><a class="rightMenu-item" href="javascript:switchNightMode();"><i class="fa fa-moon"></i><span>昼夜切换</span></a><a class="rightMenu-item" href="/about/"><i class="fa fa-info-circle"></i><span>关于博客</span></a><a class="rightMenu-item" href="javascript:toggleWinbox();"><i class="fas fa-cog"></i><span>美化设置</span></a><a class="rightMenu-item" href="javascript:rmf.fullScreen();"><i class="fas fa-expand"></i><span>切换全屏</span></a><a class="rightMenu-item" href="javascript:window.print();"><i class="fa-solid fa-print"></i><span>打印页面</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.zhangyuanhe.top/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.zhangyuanhe.top/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.textContent = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script defer src="/js/light.js"></script><script defer type="text/javascript" src="https://cdn1.tianli0.top/npm/sweetalert2@8.19.0/dist/sweetalert2.all.js"></script><script defer src="/js/lunar.js"></script><script defer src="/js/day.js"></script><script src="/js/sun_moon.js" async></script><script type="text/javascript" src="https://cdn1.tianli0.top/npm/jquery@latest/dist/jquery.min.js"></script><script type="text/javascript" src="/js/rightmenu.js"></script><script defer src="/js/another.js"></script><script defer src="/js/runtime.js"></script><script async src="/js/fps.js"></script><script async src="/js/title.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://zhangyuanhe.top/categories/博客搭建/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📚 Charmesの魔改教程 (13)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zhangyuanhe.top/categories/课程笔记/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📒 Charmesの学习笔记 (11)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zhangyuanhe.top/categories/信安课程实验/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">👩‍💻 Charmesの实验记录 (40)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item" style="visibility: hidden"></div><a class="magnet_link_more"  href="https://zhangyuanhe.top/categories" style="flex:1;text-align: center;margin-bottom: 10px;">查看更多...</a></div></div>';
    console.log('已挂载magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(50% - 5px);background: #f2f2f2;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: #b30070}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false});</script></body></html>