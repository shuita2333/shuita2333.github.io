<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>编译原理Project2——编写语义分析 | ZYH's blog</title><meta name="author" content="Charmes"><meta name="copyright" content="Charmes"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="ffffff"><meta name="referrer" content="no-referrer"><meta name="description" content="将继续构建BUPT编程语言（BPL）编译器的功能，专注于语义分析阶段">
<meta property="og:type" content="article">
<meta property="og:title" content="编译原理Project2——编写语义分析">
<meta property="og:url" content="https://zhangyuanhe.top/2023/11/20/Information_Security_Experiment/Compilation_principle/CP_Project2/index.html">
<meta property="og:site_name" content="ZYH&#39;s blog">
<meta property="og:description" content="将继续构建BUPT编程语言（BPL）编译器的功能，专注于语义分析阶段">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://zhangyuanhe.top/images/basic_configuration/wallhaven-0jp71w_1920x1080.png">
<meta property="article:published_time" content="2023-11-19T18:00:00.000Z">
<meta property="article:modified_time" content="2024-07-07T10:13:48.720Z">
<meta property="article:author" content="Charmes">
<meta property="article:tag" content="北邮信安">
<meta property="article:tag" content="编译原理">
<meta property="article:tag" content="实验报告">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zhangyuanhe.top/images/basic_configuration/wallhaven-0jp71w_1920x1080.png"><link rel="shortcut icon" href="/img/logo.png"><link rel="canonical" href="https://zhangyuanhe.top/2023/11/20/Information_Security_Experiment/Compilation_principle/CP_Project2/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":true,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":200},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":100,"languages":{"author":"作者: Charmes","link":"链接: ","source":"来源: ZYH's blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '编译原理Project2——编写语义分析',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2024-07-07 18:13:48'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 8 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/universe.css"><link rel="stylesheet" href="/css/custom.css" media="defer" onload="this.media='all'"><span id="fps"></span><svg aria-hidden="true" style="position:absolute; overflow:hidden; width:0; height:0"><symbol id="icon-sun" viewBox="0 0 1024 1024"><path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path><path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path><path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path><path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path></symbol><symbol id="icon-moon" viewBox="0 0 1024 1024"><path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path><path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path></symbol></svg><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="ZYH's blog" type="application/atom+xml">
</head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/favicon1.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">70</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">18</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">14</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 有链</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-heart"></i><span> 关于</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-address-card"></i><span> 关于作者</span></a></li><li><a class="site-page child" href="javascript:randomPost();"><i class="fa-fw fa-solid fa-shuffle"></i><span> 随便看看</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/../../images/basic_configuration/wallhaven-0jp71w_1920x1080.png')"><nav id="nav"><span id="blog-info"><a href="/" title="ZYH's blog"><img class="site-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/logo.png"/><span class="site-name">ZYH's blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间线</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> 清单</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 有链</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-heart"></i><span> 关于</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/about/"><i class="fa-fw fas fa-address-card"></i><span> 关于作者</span></a></li><li><a class="site-page child" href="javascript:randomPost();"><i class="fa-fw fa-solid fa-shuffle"></i><span> 随便看看</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">编译原理Project2——编写语义分析</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-11-19T18:00:00.000Z" title="发表于 2023-11-20 02:00:00">2023-11-20</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-07-07T10:13:48.720Z" title="更新于 2024-07-07 18:13:48">2024-07-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%BF%A1%E5%AE%89%E8%AF%BE%E7%A8%8B%E5%AE%9E%E9%AA%8C/">信安课程实验</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%BF%A1%E5%AE%89%E8%AF%BE%E7%A8%8B%E5%AE%9E%E9%AA%8C/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/">编译原理</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">9.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>50分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="编译原理Project2——编写语义分析"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p><strong>Project 2: 语义分析</strong></p>
<p>在Project 2中，你将继续构建BUPT编程语言（BPL）编译器的功能，专注于语义分析阶段。在前一个项目中完成词法和语法分析后，你已经能够生成语法有效的BPL程序的语法树。现在，语义分析阶段将确保程序有一个明确的定义，即验证程序的逻辑正确性，例如变量是否已声明、类型是否匹配等。</p>
<ol>
<li><p><strong>语义分析</strong>:</p>
<ul>
<li><strong>作用</strong>：语义分析主要确保程序中的所有声明和表达式在逻辑上是有意义和合法的，包括类型检查、变量声明、函数调用等。</li>
<li><strong>实现方式</strong>：不同于前一个项目中的工具辅助（如Flex和Bison），在这一阶段，你需要手动编写代码来实现语义分析，这可能是实现BPL编译器中最费力的部分。你需要设计各种数据结构（如符号表和数据类型表示）并仔细考虑它们最合适的实现方式。</li>
</ul>
</li>
<li><p><strong>符号表</strong>:</p>
<ul>
<li><strong>概述</strong>：符号表是映射名字到其关联信息的数据结构。在语义分析过程中，编译器将不断更新表中的信息以反映作用域内的内容。符号表的两个典型操作是插入和查找特定符号。</li>
<li><strong>实现</strong>：可以使用各种抽象数据类型来实现符号表，包括链表、二叉搜索树和哈希表。每种数据结构在空间&#x2F;时间复杂性和实现难度方面有所不同。你可以选择适合你需求的数据结构。</li>
</ul>
</li>
<li><p><strong>作用域检查</strong>:</p>
<ul>
<li><strong>概述</strong>：作用域检查是确定程序中的标识符是否在该位置可访问的过程。你可以使用不同的方法来实现支持作用域的符号表，比如命令式单一表方法或功能式独立表方法。</li>
<li><strong>实现</strong>：可以采用单一全局表，每个作用域内的符号在退出时移除；或者使用作用域栈，每个新的作用域开启一个新的符号表，并在作用域关闭时将其弹出。</li>
</ul>
</li>
<li><p><strong>类型检查</strong>:</p>
<ul>
<li><strong>类型系统</strong>：在编程语言中，类型是一组值和在这些值上操作的集合。BPL有两类数据类型：基本类型（由硬件直接提供，如int、char和float）和派生类型（由基本类型或派生类型聚合而成，如数组、结构体等）。</li>
<li><strong>类型等价性</strong>：如何确定两个类型是否等价？对于基本类型，问题很简单，例如int只等价于int。对于派生类型，事情就复杂多了。通常有两种类型等价性：命名等价性和结构等价性。命名等价性考虑类型的名称，而结构等价性考虑类型的结构。</li>
<li><strong>派生类型表示</strong>：实现层面上，代表原始类型使用常量就足够了。对于派生类型，例如数组和结构体，表示它们就比较复杂了。常见的技术是存储定义类型的基本信息为多级链表。</li>
</ul>
</li>
<li><p><strong>项目要求</strong>:</p>
<ul>
<li><strong>输入格式</strong>：与上一个项目相同，即执行文件<code>bplc</code>接受表示BPL程序路径的单个命令行参数。对于语义上合法的BPL程序，你的语义分析器不应该产生任何输出信息；否则，应该打印出有意义的错误信息。</li>
<li><strong>错误检测</strong>：你的分析器应该能够检测到一系列的语义错误，如未定义变量的使用、类型不匹配、函数调用参数不匹配等，并能够报告错误类型和行号。</li>
</ul>
</li>
</ol>
<p>通过这个项目，你将学习如何实现一个编译器的语义分析阶段，这是编译器理解程序并检测错误的关键环节。这个阶段需要对语言的类型系统、作用域规则和其他语义规则有深入的理解。</p>
<p>lex.l</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line">%&#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">include</span><span class="string">&quot;syntax.tab.h&quot;</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span> </span></span><br><span class="line">    <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span> </span></span><br><span class="line">    <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span> </span></span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> MAX_ID_SIZE 256 </span></span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> line = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">typedef</span> <span class="keyword">struct</span> <span class="title class_">Head</span> </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> terminal;</span><br><span class="line">        <span class="type">char</span> type[<span class="number">200</span>];</span><br><span class="line">        <span class="type">char</span> id[<span class="number">200</span>];</span><br><span class="line">        <span class="type">char</span> value_type[<span class="number">200</span>];   <span class="comment">//用于标记EXP的类型</span></span><br><span class="line">        <span class="type">int</span> rvalue;           <span class="comment">//用于标记是否是右值</span></span><br><span class="line">        <span class="type">int</span> lineno;</span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">Head</span>* child;</span><br><span class="line">        <span class="keyword">struct</span> <span class="title class_">Head</span>* next;</span><br><span class="line">    &#125;Node;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Head</span>* <span class="built_in">create_Node</span>(<span class="type">int</span> terminal,<span class="type">char</span>* type, <span class="type">char</span>* id, Node* child,Node* next,<span class="type">int</span> lineno);</span><br><span class="line"></span><br><span class="line">    <span class="function">Node* <span class="title">create_Node</span><span class="params">(<span class="type">int</span> terminal, <span class="type">char</span>* type, <span class="type">char</span>* id, Node* child, Node* next, <span class="type">int</span> lineno)</span> </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        Node* newNode = <span class="built_in">malloc</span>(<span class="built_in">sizeof</span>(Node));</span><br><span class="line">        <span class="keyword">if</span> (newNode == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="built_in">perror</span>(<span class="string">&quot;Memory allocation error&quot;</span>);</span><br><span class="line">            <span class="built_in">exit</span>(EXIT_FAILURE);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        newNode-&gt;terminal = terminal;</span><br><span class="line">        newNode-&gt;lineno = (lineno == <span class="number">0</span> &amp;&amp; child != <span class="literal">NULL</span>) ? child-&gt;lineno : lineno;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (type != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="built_in">strncpy</span>(newNode-&gt;type, type, <span class="built_in">sizeof</span>(newNode-&gt;type) - <span class="number">1</span>);</span><br><span class="line">            newNode-&gt;type[<span class="built_in">sizeof</span>(newNode-&gt;type) - <span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>; </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            newNode-&gt;type[<span class="number">0</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (id != <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="built_in">strncpy</span>(newNode-&gt;id, id, <span class="built_in">sizeof</span>(newNode-&gt;id) - <span class="number">1</span>);</span><br><span class="line">            newNode-&gt;id[<span class="built_in">sizeof</span>(newNode-&gt;id) - <span class="number">1</span>] = <span class="string">&#x27;\0&#x27;</span>; </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            newNode-&gt;id[<span class="number">0</span>] = <span class="string">&#x27;\0&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        newNode-&gt;child = child;</span><br><span class="line">        newNode-&gt;next = next;</span><br><span class="line">        newNode-&gt;rvalue = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> newNode;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print_tree</span><span class="params">(Node* root, <span class="type">int</span> depth)</span> </span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 对于非空节点，进行缩进处理</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(root-&gt;type, <span class="string">&quot;empty&quot;</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; depth; i++) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;  &quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 打印终端节点（叶子节点）的信息</span></span><br><span class="line">        <span class="keyword">if</span> (root-&gt;terminal == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%s&quot;</span>, root-&gt;type);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 对特定类型的节点，打印额外的信息</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">strcmp</span>(root-&gt;type, <span class="string">&quot;ID&quot;</span>) == <span class="number">0</span> || <span class="built_in">strcmp</span>(root-&gt;type,<span class="string">&quot;TYPE&quot;</span>) == <span class="number">0</span> ||</span><br><span class="line">                <span class="built_in">strcmp</span>(root-&gt;type, <span class="string">&quot;INT&quot;</span>) == <span class="number">0</span> || <span class="built_in">strcmp</span>(root-&gt;type,<span class="string">&quot;FLOAT&quot;</span>) == <span class="number">0</span> || </span><br><span class="line">                <span class="built_in">strcmp</span>(root-&gt;type, <span class="string">&quot;CHAR&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;: %s&quot;</span>, root-&gt;id);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(root-&gt;type, <span class="string">&quot;empty&quot;</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 对于非终端且非空节点，打印节点类型和所在行号</span></span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%s (%d)\n&quot;</span>, root-&gt;type, root-&gt;lineno);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 递归打印子节点，增加缩进深度</span></span><br><span class="line">        <span class="built_in">print_tree</span>(root-&gt;child, depth + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 递归打印兄弟节点，保持当前缩进深度</span></span><br><span class="line">        <span class="built_in">print_tree</span>(root-&gt;next, depth);</span><br><span class="line">    &#125;</span><br><span class="line">%&#125;</span><br><span class="line"></span><br><span class="line">%option noyywrap</span><br><span class="line"></span><br><span class="line">int_        [<span class="number">0</span><span class="number">-9</span>]+|<span class="number">0</span>x[<span class="number">0</span><span class="number">-9</span>a-fA-F]+</span><br><span class="line">float_      [<span class="number">0</span><span class="number">-9</span>]+<span class="string">&quot;.&quot;</span>[<span class="number">0</span><span class="number">-9</span>]+</span><br><span class="line">id_         [a-zA-Z_][a-zA-Z0<span class="number">-9</span>_]*</span><br><span class="line">char_       \<span class="string">&#x27;.\&#x27;</span>|\<span class="string">&#x27;\\x[0-9a-fA-F]&#123;2&#125;\&#x27;</span></span><br><span class="line"></span><br><span class="line">%%</span><br><span class="line"><span class="string">&quot;int&quot;</span>                 &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;TYPE&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> TYPE; &#125;</span><br><span class="line"><span class="string">&quot;float&quot;</span>               &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;TYPE&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> TYPE; &#125;</span><br><span class="line"><span class="string">&quot;char&quot;</span>                &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;TYPE&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> TYPE; &#125;</span><br><span class="line"><span class="string">&quot;struct&quot;</span>              &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;STRUCT&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> STRUCT; &#125;</span><br><span class="line"><span class="string">&quot;if&quot;</span>                  &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;IF&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> IF; &#125;</span><br><span class="line"><span class="string">&quot;else&quot;</span>                &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;ELSE&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> ELSE; &#125;</span><br><span class="line"><span class="string">&quot;while&quot;</span>               &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;WHILE&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> WHILE; &#125;</span><br><span class="line"><span class="string">&quot;return&quot;</span>              &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;RETURN&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> RETURN; &#125;</span><br><span class="line">&#123;int_&#125;              &#123;yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;INT&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> INT;&#125;</span><br><span class="line">&#123;float_&#125;             &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;FLOAT&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> FLOAT; &#125;</span><br><span class="line">&#123;id_&#125;               &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;ID&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> ID; &#125;</span><br><span class="line">&#123;char_&#125;             &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;CHAR&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> CHAR; &#125;</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;.&quot;</span>                 &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;DOT&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> DOT; &#125;</span><br><span class="line"><span class="string">&quot;;&quot;</span>                 &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;SEMI&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> SEMI; &#125;</span><br><span class="line"><span class="string">&quot;,&quot;</span>                 &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;COMMA&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> COMMA; &#125;</span><br><span class="line"><span class="string">&quot;=&quot;</span>                 &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;ASSIGN&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> ASSIGN; &#125;</span><br><span class="line"><span class="string">&quot;&lt;&quot;</span>                 &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;LT&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> LT; &#125;</span><br><span class="line"><span class="string">&quot;&gt;&quot;</span>                 &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;GT&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> GT; &#125;</span><br><span class="line"><span class="string">&quot;&lt;=&quot;</span>                &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;LE&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> LE; &#125;</span><br><span class="line"><span class="string">&quot;&gt;=&quot;</span>                &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;GE&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> GE; &#125;</span><br><span class="line"><span class="string">&quot;!=&quot;</span>                &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;NE&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> NE; &#125;</span><br><span class="line"><span class="string">&quot;==&quot;</span>                &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;EQ&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> EQ; &#125;</span><br><span class="line"><span class="string">&quot;+&quot;</span>                 &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;PLUS&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> PLUS; &#125;</span><br><span class="line"><span class="string">&quot;-&quot;</span>                 &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;MINUS&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> MINUS; &#125;</span><br><span class="line"><span class="string">&quot;*&quot;</span>                 &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;MUL&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> MUL; &#125;</span><br><span class="line"><span class="string">&quot;/&quot;</span>                 &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;DIV&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> DIV; &#125;</span><br><span class="line"><span class="string">&quot;&amp;&amp;&quot;</span>                &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;AND&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> AND; &#125;</span><br><span class="line"><span class="string">&quot;||&quot;</span>                &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;OR&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> OR; &#125;</span><br><span class="line"><span class="string">&quot;!&quot;</span>                 &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;NOT&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> NOT; &#125;</span><br><span class="line"><span class="string">&quot;(&quot;</span>                 &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;LP&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> LP; &#125;</span><br><span class="line"><span class="string">&quot;)&quot;</span>                 &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;RP&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> RP; &#125;</span><br><span class="line"><span class="string">&quot;[&quot;</span>                 &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;LB&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> LB; &#125;</span><br><span class="line"><span class="string">&quot;]&quot;</span>                 &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;RB&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> RB; &#125;</span><br><span class="line"><span class="string">&quot;&#123;&quot;</span>                 &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;LC&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> LC; &#125;</span><br><span class="line"><span class="string">&quot;&#125;&quot;</span>                 &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;RC&quot;</span>,yytext,<span class="literal">NULL</span>,<span class="literal">NULL</span>,line);<span class="keyword">return</span> RC; &#125;</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;/*&quot;</span>([^*]|[*][^/]|[*][*]+[^*/])*<span class="string">&quot;*/&quot;</span>  &#123;<span class="comment">/* ignore comments */</span>&#125;</span><br><span class="line">[ \t\r]+            &#123;<span class="comment">/* ignore whitespace */</span>&#125;</span><br><span class="line"><span class="string">&quot;\n&quot;</span>    &#123;line++;&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">0</span>x([<span class="number">0</span><span class="number">-9</span>a-fA-F]|[g-zG-Z])+     &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;ILLEGAL_HEX_INT&quot;</span>, yytext, <span class="literal">NULL</span>, <span class="literal">NULL</span>, line); <span class="keyword">return</span> ILLEGAL_HEX_INT; &#125;</span><br><span class="line">[<span class="number">0</span><span class="number">-9</span>]&#123;id_&#125;          &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;ILLEGAL_ID&quot;</span>, yytext, <span class="literal">NULL</span>, <span class="literal">NULL</span>, line); <span class="keyword">return</span> ILLEGAL_ID; &#125;</span><br><span class="line"><span class="string">&#x27;\\x.*&#x27;</span>                        &#123; yylval.node=<span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;ILLEGAL_CHAR&quot;</span>, yytext, <span class="literal">NULL</span>, <span class="literal">NULL</span>, line); <span class="keyword">return</span> ILLEGAL_CHAR; &#125;</span><br><span class="line">.                   &#123; yylval.node = <span class="built_in">create_Node</span>(<span class="number">1</span>,<span class="string">&quot;ILLEGAL&quot;</span>, yytext, <span class="literal">NULL</span>, <span class="literal">NULL</span>, line); <span class="keyword">return</span> ILLEGAL; &#125;</span><br><span class="line">%%</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>syntax.y</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br><span class="line">710</span><br><span class="line">711</span><br><span class="line">712</span><br><span class="line">713</span><br><span class="line">714</span><br><span class="line">715</span><br><span class="line">716</span><br><span class="line">717</span><br><span class="line">718</span><br><span class="line">719</span><br><span class="line">720</span><br><span class="line">721</span><br><span class="line">722</span><br><span class="line">723</span><br><span class="line">724</span><br><span class="line">725</span><br><span class="line">726</span><br><span class="line">727</span><br><span class="line">728</span><br><span class="line">729</span><br><span class="line">730</span><br><span class="line">731</span><br><span class="line">732</span><br><span class="line">733</span><br><span class="line">734</span><br><span class="line">735</span><br><span class="line">736</span><br><span class="line">737</span><br><span class="line">738</span><br></pre></td><td class="code"><pre><span class="line">%&#123;</span><br><span class="line">    <span class="meta">#<span class="keyword">include</span> <span class="string">&quot;lex.yy.c&quot;</span></span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdarg.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="meta">#<span class="keyword">include</span> <span class="string">&quot;myhead.h&quot;</span></span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">yyerror</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    Node* root=<span class="literal">NULL</span>;</span><br><span class="line">    <span class="type">int</span> flag=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">connect_to_next</span><span class="params">(<span class="type">int</span> next_num, ...)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (next_num &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// 如果没有节点或参数数量为负，不执行任何操作</span></span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    va_list valist;</span><br><span class="line">    <span class="built_in">va_start</span>(valist, next_num); </span><br><span class="line"></span><br><span class="line">    Node* temp = <span class="built_in">va_arg</span>(valist, Node*); <span class="comment">// 获取第一个节点</span></span><br><span class="line">    Node* prev = temp; </span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt; next_num; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        temp = <span class="built_in">va_arg</span>(valist, Node*); <span class="comment">// 获取下一个节点</span></span><br><span class="line">        <span class="keyword">if</span> (prev) &#123;</span><br><span class="line">            prev-&gt;next = temp; </span><br><span class="line">        &#125;</span><br><span class="line">        prev = temp; <span class="comment">// 更新</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (temp) &#123;</span><br><span class="line">        temp-&gt;next = <span class="literal">NULL</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">va_end</span>(valist); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">bool</span> is_in_function=<span class="literal">false</span>;<span class="comment">//标记当前是否在函数体内部，如果不是，则不允许定义变量</span></span><br><span class="line">    <span class="type">char</span> *current_function_name;<span class="comment">//标记当前所在的函数名</span></span><br><span class="line">    <span class="type">bool</span> index_error=<span class="literal">false</span>; <span class="comment">//标记数组下标是否出错</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">find_compst_return</span><span class="params">(Node *Compst, <span class="type">char</span> *expected_type)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">check_nested_statements</span><span class="params">(Node *stmt, <span class="type">char</span> *expected_type)</span></span>;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 结构体操作 */</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert_vardec</span><span class="params">(Node *node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!node-&gt;child-&gt;next) &#123;</span><br><span class="line">            <span class="comment">// 如果子节点没有next成员，则不是数组类型</span></span><br><span class="line">            <span class="built_in">add_dec</span>(node-&gt;child-&gt;id, last_type, node-&gt;lineno);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 如果子节点有next成员，则为数组类型</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">add_dec</span>(node-&gt;child-&gt;child-&gt;id, <span class="string">&quot;array&quot;</span>, node-&gt;lineno)) &#123;</span><br><span class="line">                <span class="built_in">add_array</span>(node-&gt;child-&gt;child-&gt;id, last_type, node-&gt;lineno);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert_ExtDecList</span><span class="params">(Node* node)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 处理当前变量声明</span></span><br><span class="line">        <span class="built_in">insert_vardec</span>(node-&gt;child);</span><br><span class="line">        <span class="keyword">if</span> (node-&gt;child-&gt;next) &#123;</span><br><span class="line">            <span class="comment">// 如果存在多个变量声明（逗号分隔），递归处理余下的声明</span></span><br><span class="line">            <span class="built_in">insert_ExtDecList</span>(node-&gt;child-&gt;next-&gt;next);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add_struct_member_deflist</span><span class="params">(Node* node, <span class="type">char</span>* struct_name)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">//用于处理struct内部的成员声明</span></span><br><span class="line">        <span class="comment">//node为DefList</span></span><br><span class="line">        <span class="comment">//struct_name为结构体名</span></span><br><span class="line">        <span class="keyword">if</span>(!node||!node-&gt;child)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Node* temp=node-&gt;child;</span><br><span class="line">        <span class="comment">//temp即Def</span></span><br><span class="line">        Node* temp2=temp-&gt;child;</span><br><span class="line">        <span class="comment">//temp2即Specifier</span></span><br><span class="line">        <span class="comment">//char* type=temp2-&gt;child-&gt;id;</span></span><br><span class="line">        <span class="type">char</span> *type;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(temp2-&gt;child-&gt;type,<span class="string">&quot;TYPE&quot;</span>)==<span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//不是结构体</span></span><br><span class="line">            type=temp2-&gt;child-&gt;id;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//是结构体</span></span><br><span class="line">            type=temp2-&gt;child-&gt;child-&gt;next-&gt;id;</span><br><span class="line">        &#125;</span><br><span class="line">        Node *temp3=temp-&gt;child-&gt;next;</span><br><span class="line">        <span class="comment">//temp3即DecList</span></span><br><span class="line">        <span class="keyword">while</span>(temp3)</span><br><span class="line">        &#123;</span><br><span class="line">            Node* temp4=temp3-&gt;child;</span><br><span class="line">            <span class="comment">//temp4即Dec</span></span><br><span class="line">            Node* temp5=temp4-&gt;child;</span><br><span class="line">            <span class="comment">//temp5即VarDec</span></span><br><span class="line">            <span class="keyword">if</span>(temp5-&gt;child-&gt;next==<span class="literal">NULL</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//不是数组</span></span><br><span class="line">                <span class="built_in">add_struct_member</span>(struct_name,temp5-&gt;child-&gt;id,type,temp5-&gt;lineno);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//是数组</span></span><br><span class="line">                <span class="built_in">add_struct_member</span>(struct_name,temp5-&gt;child-&gt;child-&gt;id,<span class="string">&quot;array&quot;</span>,temp5-&gt;lineno);</span><br><span class="line">                <span class="built_in">add_array</span>(temp5-&gt;child-&gt;child-&gt;id,type,temp5-&gt;lineno);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(temp3-&gt;child-&gt;next)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//Dec COMMA DecList</span></span><br><span class="line">                temp3=temp3-&gt;child-&gt;next-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//Dec</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(node-&gt;child)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//Def DefList</span></span><br><span class="line">            <span class="built_in">add_struct_member_deflist</span>(node-&gt;child-&gt;next,struct_name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//Def</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 函数参数和变量插入 */</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert_function_args</span><span class="params">(<span class="type">char</span> *func_name, Node *node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="comment">// 如果节点为空，没有更多的变量需要处理，返回</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 处理当前的ParamDec节点</span></span><br><span class="line">        Node *param = node-&gt;child;</span><br><span class="line">        Node *specifier = param-&gt;child;</span><br><span class="line">        Node *vardec = specifier-&gt;next;</span><br><span class="line">        <span class="type">char</span> *type = specifier-&gt;child-&gt;id; <span class="comment">// 获取类型</span></span><br><span class="line">        <span class="type">char</span> *name = vardec-&gt;child-&gt;id;    <span class="comment">// 获取变量名</span></span><br><span class="line">        <span class="comment">// 为简单起见，此处假设参数是非数组类型</span></span><br><span class="line">        <span class="built_in">add_func_args</span>(func_name, name, type, param-&gt;lineno);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果存在COMMA，说明后面还有参数，递归处理后续的VarList</span></span><br><span class="line">        Node *nextParam = node-&gt;child-&gt;next;</span><br><span class="line">        <span class="keyword">if</span> (nextParam != <span class="literal">NULL</span> &amp;&amp; <span class="built_in">strcmp</span>(nextParam-&gt;type, <span class="string">&quot;COMMA&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">insert_function_args</span>(func_name, nextParam-&gt;next);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">insert_func_variables</span><span class="params">(Node *Dec)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 如果不在函数内部或输入节点为空，则不需要处理</span></span><br><span class="line">        <span class="keyword">if</span> (!is_in_function || Dec == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 在函数体内部</span></span><br><span class="line">        Node *VarDec = Dec-&gt;child;</span><br><span class="line">        <span class="type">char</span> *var_name;</span><br><span class="line">        <span class="type">char</span> *var_type;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 判断是否为数组类型</span></span><br><span class="line">        <span class="keyword">if</span> (VarDec-&gt;child-&gt;next) &#123;</span><br><span class="line">            <span class="comment">// 处理数组类型的变量</span></span><br><span class="line">            var_name = VarDec-&gt;child-&gt;child-&gt;id;</span><br><span class="line">            var_type = <span class="string">&quot;array&quot;</span>;</span><br><span class="line">            <span class="built_in">add_func_variables</span>(current_function_name, var_name, var_type, VarDec-&gt;lineno);</span><br><span class="line">            <span class="built_in">add_array</span>(var_name, last_type, VarDec-&gt;lineno);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 处理普通变量</span></span><br><span class="line">            var_name = VarDec-&gt;child-&gt;id;</span><br><span class="line">            var_type = last_type;</span><br><span class="line">            <span class="built_in">add_func_variables</span>(current_function_name, var_name, var_type, VarDec-&gt;lineno);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查赋值语句并验证类型匹配</span></span><br><span class="line">        Node *Assign = VarDec-&gt;next;</span><br><span class="line">        <span class="keyword">if</span> (Assign &amp;&amp; <span class="built_in">strcmp</span>(Assign-&gt;type, <span class="string">&quot;ASSIGN&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            Node *Exp = Assign-&gt;next;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">strcmp</span>(Exp-&gt;value_type, <span class="string">&quot;error&quot;</span>) != <span class="number">0</span> &amp;&amp; <span class="built_in">strcmp</span>(Exp-&gt;value_type, last_type) != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Error type 5 at line %d: Type mismatched for assignment\n&quot;</span>, Exp-&gt;lineno);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 表达式检查 */</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">check_type</span><span class="params">(Node *exp, <span class="type">const</span> <span class="type">char</span> *expected_type, <span class="type">int</span> error_type, <span class="type">int</span> lineno)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(exp-&gt;value_type, <span class="string">&quot;error&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 类型已经是错误，之前的步骤中已经报错，此处不再重复。</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (expected_type != <span class="literal">NULL</span> &amp;&amp; <span class="built_in">strcmp</span>(exp-&gt;value_type, expected_type) != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Error type %d at line %d: Type mismatched for operands\n&quot;</span>, error_type, lineno);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">check_single_arithmetic_exp</span><span class="params">(Node *exp)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 检查单个Exp的类型是否为int或者float</span></span><br><span class="line">        <span class="built_in">check_type</span>(exp, <span class="literal">NULL</span>, <span class="number">7</span>, exp-&gt;lineno);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(exp-&gt;value_type, <span class="string">&quot;int&quot;</span>) != <span class="number">0</span> &amp;&amp; <span class="built_in">strcmp</span>(exp-&gt;value_type, <span class="string">&quot;float&quot;</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Error type 7 at line %d: Type mismatched for operands, expected int or float\n&quot;</span>, exp-&gt;lineno);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">check_single_logical_exp</span><span class="params">(Node *exp)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 检查单个Exp的类型是否为int</span></span><br><span class="line">        <span class="built_in">check_type</span>(exp, <span class="string">&quot;int&quot;</span>, <span class="number">7</span>, exp-&gt;lineno);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">check_exp_arithmetic_symbols</span><span class="params">(Node *exp1, Node *exp2)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 假设算术运算只能由int或float类型的变量进行</span></span><br><span class="line">        <span class="built_in">check_type</span>(exp1, <span class="literal">NULL</span>, <span class="number">7</span>, exp1-&gt;lineno);</span><br><span class="line">        <span class="built_in">check_type</span>(exp2, <span class="literal">NULL</span>, <span class="number">7</span>, exp2-&gt;lineno);</span><br><span class="line">        <span class="keyword">if</span> ((<span class="built_in">strcmp</span>(exp1-&gt;value_type, <span class="string">&quot;int&quot;</span>) != <span class="number">0</span> &amp;&amp; <span class="built_in">strcmp</span>(exp1-&gt;value_type, <span class="string">&quot;float&quot;</span>) != <span class="number">0</span>) || </span><br><span class="line">            (<span class="built_in">strcmp</span>(exp2-&gt;value_type, <span class="string">&quot;int&quot;</span>) != <span class="number">0</span> &amp;&amp; <span class="built_in">strcmp</span>(exp2-&gt;value_type, <span class="string">&quot;float&quot;</span>) != <span class="number">0</span>)) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Error type 7 at line %d: Type mismatched for operands, expected int or float\n&quot;</span>, exp1-&gt;lineno);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(exp1-&gt;value_type, exp2-&gt;value_type) != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Error type 7 at line %d: Type mismatched for operands, expected same type\n&quot;</span>, exp1-&gt;lineno);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">check_exp_logical_symbols</span><span class="params">(Node *exp1, Node *exp2)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 假设逻辑运算只能由int类型的变量进行</span></span><br><span class="line">        <span class="built_in">check_type</span>(exp1, <span class="string">&quot;int&quot;</span>, <span class="number">7</span>, exp1-&gt;lineno);</span><br><span class="line">        <span class="built_in">check_type</span>(exp2, <span class="string">&quot;int&quot;</span>, <span class="number">7</span>, exp2-&gt;lineno);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">check_exp_assign</span><span class="params">(Node *exp1, Node *exp2)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 用于检查赋值语句左右两边的类型是否匹配</span></span><br><span class="line">        <span class="built_in">check_type</span>(exp1, <span class="literal">NULL</span>, <span class="number">6</span>, exp1-&gt;lineno);</span><br><span class="line">        <span class="built_in">check_type</span>(exp2, <span class="literal">NULL</span>, <span class="number">5</span>, exp2-&gt;lineno);</span><br><span class="line">        <span class="keyword">if</span> (exp1-&gt;rvalue) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Error type 6 at line %d: rvalue on the left side of assignment operator\n&quot;</span>, exp1-&gt;lineno);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(exp1-&gt;value_type, exp2-&gt;value_type) != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Error type 5 at line %d: Type mismatched for assignment\n&quot;</span>, exp1-&gt;lineno);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">check_Exp_with_specific_type</span><span class="params">(Node *Exp, <span class="type">char</span> *expected_type)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 用于检查Exp的类型是否为expected_type</span></span><br><span class="line">        <span class="built_in">check_type</span>(Exp, expected_type, <span class="number">7</span>, Exp-&gt;lineno);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">check_Def</span><span class="params">(Node *Def)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// expected_type 为定义的类型</span></span><br><span class="line">        <span class="type">char</span> *expected_type = last_type;</span><br><span class="line">        Node *DecList = Def-&gt;child-&gt;next;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 循环处理定义列表中的所有声明</span></span><br><span class="line">        <span class="keyword">while</span> (DecList) &#123;</span><br><span class="line">            Node *Dec = DecList-&gt;child;</span><br><span class="line">            Node *VarDec = Dec-&gt;child;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 如果存在赋值（ASSIGN），检查表达式（Exp）的类型是否匹配</span></span><br><span class="line">            Node *Assign = VarDec-&gt;next;</span><br><span class="line">            <span class="keyword">if</span> (Assign &amp;&amp; <span class="built_in">strcmp</span>(Assign-&gt;type, <span class="string">&quot;ASSIGN&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                Node *Exp = Assign-&gt;next;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">strcmp</span>(Exp-&gt;value_type, <span class="string">&quot;error&quot;</span>) != <span class="number">0</span> &amp;&amp; <span class="built_in">strcmp</span>(Exp-&gt;value_type, expected_type) != <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;Error type 5 at line %d: Type mismatched for assignment\n&quot;</span>, Exp-&gt;lineno);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 移动到下一个声明，如果存在</span></span><br><span class="line">            DecList = (Dec-&gt;next &amp;&amp; <span class="built_in">strcmp</span>(Dec-&gt;next-&gt;type, <span class="string">&quot;COMMA&quot;</span>) == <span class="number">0</span>) ? Dec-&gt;next-&gt;next : <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置节点的值为右值 </span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">set_rvalue</span><span class="params">(Node *node)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node) &#123;</span><br><span class="line">            node-&gt;rvalue = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置节点的类型</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">set_EXP_value_type</span><span class="params">(Node *node, <span class="type">char</span> *type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (node &amp;&amp; type) &#123;</span><br><span class="line">            <span class="built_in">strcpy</span>(node-&gt;value_type, type);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 函数参数和返回类型检查 */</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">check_func_return_type</span><span class="params">(Node* Compst, <span class="type">char</span> *expected_type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!is_in_function || Compst == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="comment">// 如果不在函数内部或者Compst为空，则不需要处理</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 递归检查函数体中的返回语句</span></span><br><span class="line">        <span class="built_in">find_compst_return</span>(Compst, expected_type);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">find_compst_return</span><span class="params">(Node *Compst, <span class="type">char</span> *expected_type)</span> </span>&#123;</span><br><span class="line">        Node *stmtlist = Compst-&gt;child-&gt;next-&gt;next;</span><br><span class="line">        <span class="keyword">while</span> (stmtlist &amp;&amp; stmtlist-&gt;child) &#123;</span><br><span class="line">            Node *stmt = stmtlist-&gt;child;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">strcmp</span>(stmt-&gt;child-&gt;type, <span class="string">&quot;RETURN&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                Node *exp = stmt-&gt;child-&gt;next;</span><br><span class="line">                <span class="keyword">if</span> (exp &amp;&amp; <span class="built_in">strcmp</span>(exp-&gt;value_type, expected_type) != <span class="number">0</span> &amp;&amp; <span class="built_in">strcmp</span>(exp-&gt;value_type, <span class="string">&quot;error&quot;</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;Error type 8 at line %d: The return type mismatched\n&quot;</span>, exp-&gt;lineno);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(stmt-&gt;child-&gt;type, <span class="string">&quot;CompSt&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="built_in">find_compst_return</span>(stmt-&gt;child, expected_type);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 处理可能嵌套的结构，如if-else和while语句</span></span><br><span class="line">                <span class="built_in">check_nested_statements</span>(stmt, expected_type);</span><br><span class="line">            &#125;</span><br><span class="line">            stmtlist = stmtlist-&gt;next ? stmtlist-&gt;next-&gt;child : <span class="literal">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">check_nested_statements</span><span class="params">(Node *stmt, <span class="type">char</span> *expected_type)</span> </span>&#123;</span><br><span class="line">        Node *head = stmt-&gt;child;</span><br><span class="line">        <span class="keyword">while</span> (head) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">strcmp</span>(head-&gt;type, <span class="string">&quot;Stmt&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">strcmp</span>(head-&gt;child-&gt;type, <span class="string">&quot;CompSt&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="built_in">find_compst_return</span>(head-&gt;child, expected_type);</span><br><span class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(head-&gt;child-&gt;type, <span class="string">&quot;RETURN&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                    Node *exp = head-&gt;child-&gt;next;</span><br><span class="line">                    <span class="keyword">if</span> (exp &amp;&amp; <span class="built_in">strcmp</span>(exp-&gt;value_type, expected_type) != <span class="number">0</span> &amp;&amp; <span class="built_in">strcmp</span>(exp-&gt;value_type, <span class="string">&quot;error&quot;</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="built_in">printf</span>(<span class="string">&quot;Error type 8 at line %d: The return type mismatched\n&quot;</span>, exp-&gt;lineno);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            head = head-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">check_func_args</span><span class="params">(<span class="type">char</span> *func_name, Node *Args, <span class="type">int</span> arg_index)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 查找函数定义</span></span><br><span class="line">        <span class="type">int</span> func_index;</span><br><span class="line">        <span class="keyword">for</span>(func_index = <span class="number">0</span>; func_index &lt; def_num; func_index++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">strcmp</span>(def[func_index].name, func_name) == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果没有找到函数，直接返回</span></span><br><span class="line">        <span class="keyword">if</span>(func_index == def_num) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        Node *current_arg = Args-&gt;child;</span><br><span class="line">        <span class="comment">// 检查参数个数和类型是否匹配</span></span><br><span class="line">        <span class="keyword">if</span>(arg_index &lt; def[func_index].arg_num) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">strcmp</span>(current_arg-&gt;value_type, def[func_index].args[arg_index].type) != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;Error type 9 at line %d: Unmatched argument type for Function \&quot;%s\&quot;\n&quot;</span>, current_arg-&gt;lineno, func_name);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Error type 9 at line %d: Too many arguments for Function \&quot;%s\&quot;\n&quot;</span>, current_arg-&gt;lineno, func_name);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 递归检查下一个参数，如果存在</span></span><br><span class="line">        <span class="keyword">if</span>(current_arg-&gt;next) &#123;</span><br><span class="line">            <span class="built_in">check_func_args</span>(func_name, current_arg-&gt;next-&gt;next, arg_index + <span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(arg_index + <span class="number">1</span> &lt; def[func_index].arg_num) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Error type 9 at line %d: Too few arguments for Function \&quot;%s\&quot;\n&quot;</span>, current_arg-&gt;lineno, func_name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">check_func_without_args</span><span class="params">(<span class="type">char</span> *func_name, <span class="type">int</span> lineno)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 查找函数定义</span></span><br><span class="line">        <span class="type">int</span> func_index;</span><br><span class="line">        <span class="keyword">for</span>(func_index = <span class="number">0</span>; func_index &lt; def_num; func_index++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">strcmp</span>(def[func_index].name, func_name) == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果没有找到函数，直接返回</span></span><br><span class="line">        <span class="keyword">if</span>(func_index == def_num) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(def[func_index].arg_num != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Error type 9 at line %d: Function \&quot;%s\&quot; expects no arguments\n&quot;</span>, lineno, func_name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 数组操作检查 */</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">check_exp_array</span><span class="params">(Node *array_exp, Node *index_exp)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 如果下标或数组表达式的类型已经是错误，不再进行检查</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(index_exp-&gt;value_type, <span class="string">&quot;error&quot;</span>) == <span class="number">0</span> || <span class="built_in">strcmp</span>(array_exp-&gt;value_type, <span class="string">&quot;error&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 检查是否应用了下标操作符到非数组类型的变量上</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(array_exp-&gt;value_type, <span class="string">&quot;array&quot;</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Error type 10 at line %d: Indexing operator ([...]) applied to non-array variable \&quot;%s\&quot;.\n&quot;</span>, array_exp-&gt;lineno, array_exp-&gt;id);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 检查下标是否为整型</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(index_exp-&gt;value_type, <span class="string">&quot;int&quot;</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Error type 12 at line %d: Array index is not an integer.\n&quot;</span>, index_exp-&gt;lineno);</span><br><span class="line">            index_error = <span class="literal">true</span>; <span class="comment">// 确保外部标记了存在下标错误</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">char</span>* <span class="title">find_array_elem_type</span><span class="params">(Node *exp)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 找到数组的ID节点</span></span><br><span class="line">        Node *id = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="type">bool</span> found = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">while</span> (exp-&gt;child &amp;&amp; !found) &#123;</span><br><span class="line">            exp = exp-&gt;child;</span><br><span class="line">            Node *temp = exp;</span><br><span class="line">            <span class="keyword">while</span> (temp) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">strcmp</span>(temp-&gt;type, <span class="string">&quot;ID&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">                    id = temp;</span><br><span class="line">                    found = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                temp = temp-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 在定义中查找匹配的数组并返回其元素类型</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; def_num; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">strcmp</span>(def[i].name, id-&gt;id) == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> def[i].elem_type;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>; <span class="comment">// 如果没有找到匹配的定义，返回NULL</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 结构体成员检查 */</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">check_exp_structure</span><span class="params">(Node *structure_exp, Node *member_id)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 如果表达式类型有错误，则不再检查</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(structure_exp-&gt;value_type, <span class="string">&quot;error&quot;</span>) == <span class="number">0</span> || <span class="built_in">strcmp</span>(member_id-&gt;value_type, <span class="string">&quot;error&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查是否为结构体</span></span><br><span class="line">        <span class="type">bool</span> is_structure_found = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; dec_num &amp;&amp; !is_structure_found; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">strcmp</span>(dec[i].name, structure_exp-&gt;value_type) == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">strcmp</span>(dec[i].type, <span class="string">&quot;structure&quot;</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;Error type 13 at line %d: Illegal member access on non-structure variable \&quot;%s\&quot;\n&quot;</span>, </span><br><span class="line">                        structure_exp-&gt;lineno, structure_exp-&gt;id);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                is_structure_found = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果没有找到对应的结构体定义，则报错</span></span><br><span class="line">        <span class="keyword">if</span> (!is_structure_found) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Error type 13 at line %d: Illegal member access on non-structure variable \&quot;%s\&quot;\n&quot;</span>, </span><br><span class="line">                structure_exp-&gt;lineno, structure_exp-&gt;id);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 检查结构体内是否有该成员</span></span><br><span class="line">        <span class="type">char</span> *type = <span class="built_in">find_structure_member_type</span>(structure_exp-&gt;value_type, member_id-&gt;id);</span><br><span class="line">        <span class="keyword">if</span> (!type) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Error type 14 at line %d: Structure &#x27;%s&#x27; has no member named &#x27;%s&#x27;\n&quot;</span>, </span><br><span class="line">                structure_exp-&gt;lineno, structure_exp-&gt;value_type, member_id-&gt;id);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 函数调用检查 */</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">check_if_func_exist</span><span class="params">(<span class="type">char</span> *name, <span class="type">int</span> lineno)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 首先检查全局声明是否包含该名称</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; dec_num; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">strcmp</span>(dec[i].name, name) == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// 名称匹配，检查是否为函数类型</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">strcmp</span>(dec[i].type, <span class="string">&quot;function&quot;</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;Error type 11 at Line %d: &#x27;%s&#x27; is not a function name.\n&quot;</span>, lineno, name);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 接下来检查当前函数内部是否有同名的参数或局部声明</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; def_num; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">strcmp</span>(def[i].name, current_function_name) == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// 检查参数</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; def[i].arg_num; ++j) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="built_in">strcmp</span>(def[i].args[j].name, name) == <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="built_in">printf</span>(<span class="string">&quot;Error type 11 at Line %d: &#x27;%s&#x27; is a parameter, not a function.\n&quot;</span>, lineno, name);</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 检查局部声明</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; def[i].dec_num; ++j) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="built_in">strcmp</span>(def[i].dec[j].name, name) == <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(def[i].dec[j].type, <span class="string">&quot;function&quot;</span>) != <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="built_in">printf</span>(<span class="string">&quot;Error type 11 at Line %d: &#x27;%s&#x27; is not a function name.\n&quot;</span>, lineno, name);</span><br><span class="line">                            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果前面的检查都没有返回，意味着函数未定义</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Error type 2 at Line %d: Function \&quot;%s\&quot; is invoked without definition.\n&quot;</span>, lineno, name);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 变量检查 */</span></span><br><span class="line">    <span class="function"><span class="type">char</span>* <span class="title">check_exp_id</span><span class="params">(Node *id)</span> </span>&#123;</span><br><span class="line">        <span class="type">char</span> *type = <span class="string">&quot;error&quot;</span>; <span class="comment">// 默认类型为 &quot;error&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 首先在全局声明中检索</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; dec_num; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">strcmp</span>(dec[i].name, id-&gt;id) == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> dec[i].type; <span class="comment">// 找到匹配，返回对应类型</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 再检查是否为某个结构体定义的成员</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; def_num; ++i) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; def[i].dec_num; ++j) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">strcmp</span>(def[i].dec[j].name, id-&gt;id) == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> def[i].dec[j].type; <span class="comment">// 找到匹配，返回对应类型</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 最后检查是否为当前函数的参数或局部变量</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; def_num; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">strcmp</span>(def[i].name, current_function_name) == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// 检查参数</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; def[i].arg_num; ++j) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="built_in">strcmp</span>(def[i].args[j].name, id-&gt;id) == <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> def[i].args[j].type; <span class="comment">// 找到匹配，返回对应类型</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 检查局部变量</span></span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; def[i].dec_num; ++j) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="built_in">strcmp</span>(def[i].dec[j].name, id-&gt;id) == <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> def[i].dec[j].type; <span class="comment">// 找到匹配，返回对应类型</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 如果标识符未定义并且处于函数内部，则打印错误信息</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(type, <span class="string">&quot;error&quot;</span>) == <span class="number">0</span> &amp;&amp; is_in_function) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Error type 1 at line %d: Undefined variable \&quot;%s\&quot;.\n&quot;</span>, id-&gt;lineno, id-&gt;id);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> type; <span class="comment">// 如果没有找到匹配的声明，返回 &quot;error&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">%&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">%<span class="keyword">union</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span>     num;</span><br><span class="line">    <span class="type">char</span>*   str;</span><br><span class="line">    <span class="keyword">struct</span> <span class="title class_">Head</span>* node; <span class="comment">/*&quot;struct&quot; is indispensable*/</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">%right ASSIGN</span><br><span class="line">%left OR</span><br><span class="line">%left AND</span><br><span class="line">%left LT LE GT GE NE EQ</span><br><span class="line">%left PLUS MINUS</span><br><span class="line">%left MUL DIV</span><br><span class="line">%right NOT NEGATIVE</span><br><span class="line">%nonassoc LC RC LB RB LP RP DOT</span><br><span class="line"></span><br><span class="line">%token &lt;node&gt; ID INT FLOAT CHAR STRUCT RETURN IF ELSE WHILE PLUS MINUS MUL DIV AND OR LT LE GT GE NE EQ NOT ASSIGN TYPE LP RP LB RB LC RC SEMI COMMA DOT ILLEGAL ILLEGAL_ID ILLEGAL_HEX_INT ILLEGAL_CHAR</span><br><span class="line"></span><br><span class="line">%type &lt;node&gt; Program ExtDefList ExtDef ExtDecList Specifier StructSpecifier VarDec FunDec VarList ParamDec CompSt StmtList Stmt DefList Def DecList Dec Exp Args</span><br><span class="line">%%</span><br><span class="line"></span><br><span class="line">Program: ExtDefList &#123;$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Program&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);root=$$;&#125;</span><br><span class="line"></span><br><span class="line">ExtDefList: ExtDef ExtDefList  &#123;<span class="built_in">connect_to_next</span>(<span class="number">2</span>,$<span class="number">1</span>,$<span class="number">2</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;ExtDefList&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);&#125;</span><br><span class="line">          | <span class="comment">/* empty */</span>         &#123;$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;empty&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>,<span class="number">100</span>);&#125;</span><br><span class="line"></span><br><span class="line">ExtDef: Specifier ExtDecList SEMI   &#123;<span class="built_in">connect_to_next</span>(<span class="number">3</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;ExtDef&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="built_in">insert_ExtDecList</span>($<span class="number">2</span>);&#125;</span><br><span class="line">      | Specifier ExtDecList error  &#123;<span class="built_in">printf</span>(<span class="string">&quot;Error type B at line %d: missing semicolon &#x27;;&#x27;\n&quot;</span>, $<span class="number">1</span>-&gt;lineno);&#125;</span><br><span class="line">      | Specifier SEMI              &#123;<span class="built_in">connect_to_next</span>(<span class="number">2</span>,$<span class="number">1</span>,$<span class="number">2</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;ExtDef&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);&#125;</span><br><span class="line">      | Specifier FunDec CompSt     &#123;<span class="built_in">connect_to_next</span>(<span class="number">3</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;ExtDef&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="keyword">if</span>(is_in_function)&#123;<span class="built_in">set_func_return_type</span>(current_function_name,$<span class="number">1</span>-&gt;child-&gt;id);<span class="built_in">check_func_return_type</span>($<span class="number">3</span>,$<span class="number">1</span>-&gt;child-&gt;id);&#125;is_in_function=<span class="literal">false</span>;&#125;</span><br><span class="line"></span><br><span class="line">ExtDecList: VarDec                      &#123;$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;ExtDecList&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);&#125;</span><br><span class="line">           | VarDec COMMA ExtDecList    &#123;<span class="built_in">connect_to_next</span>(<span class="number">3</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;ExtDecList&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);&#125;</span><br><span class="line"></span><br><span class="line">Specifier: TYPE                         &#123;$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Specifier&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="built_in">set_last_type</span>($<span class="number">1</span>-&gt;id);&#125;</span><br><span class="line">          | StructSpecifier             &#123;$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Specifier&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);&#125;</span><br><span class="line"></span><br><span class="line">StructSpecifier: STRUCT ID LC DefList RC    &#123;<span class="built_in">connect_to_next</span>(<span class="number">5</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>,$<span class="number">4</span>,$<span class="number">5</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;StructSpecifier&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="keyword">if</span>(<span class="built_in">add_dec</span>($<span class="number">2</span>-&gt;id,<span class="string">&quot;structure&quot;</span>,$<span class="number">2</span>-&gt;lineno)&amp;&amp;<span class="built_in">add_func_or_struct</span>($<span class="number">2</span>-&gt;id,$<span class="number">2</span>-&gt;lineno,<span class="string">&quot;structure&quot;</span>))&#123;<span class="built_in">add_struct_member_deflist</span>($<span class="number">4</span>,$<span class="number">2</span>-&gt;id);&#125;&#125;</span><br><span class="line">               | STRUCT ID                  &#123;<span class="built_in">connect_to_next</span>(<span class="number">2</span>,$<span class="number">1</span>,$<span class="number">2</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;StructSpecifier&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="built_in">set_last_type</span>($<span class="number">2</span>-&gt;id);&#125;</span><br><span class="line"></span><br><span class="line">VarDec: ID                              &#123;$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;VarDec&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);&#125;</span><br><span class="line">       | ILLEGAL_ID error               &#123;<span class="built_in">printf</span>(<span class="string">&quot;Error type A at line %d: illegal identifier &#x27;%s&#x27;\n&quot;</span>, $<span class="number">1</span>-&gt;lineno,$<span class="number">1</span>-&gt;id);&#125;</span><br><span class="line">       | VarDec LB INT RB               &#123;<span class="built_in">connect_to_next</span>(<span class="number">4</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>,$<span class="number">4</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;VarDec&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);&#125;</span><br><span class="line"></span><br><span class="line">FunDec: ID LP VarList RP                &#123;<span class="built_in">connect_to_next</span>(<span class="number">4</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>,$<span class="number">4</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;FunDec&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="keyword">if</span>(<span class="built_in">add_dec</span>($<span class="number">1</span>-&gt;id,<span class="string">&quot;function&quot;</span>,$<span class="number">1</span>-&gt;lineno)&amp;&amp;<span class="built_in">add_func_or_struct</span>($<span class="number">1</span>-&gt;id,$<span class="number">1</span>-&gt;lineno,<span class="string">&quot;function&quot;</span>))&#123;<span class="built_in">insert_function_args</span>($<span class="number">1</span>-&gt;id,$<span class="number">3</span>);current_function_name=$<span class="number">1</span>-&gt;id;is_in_function=<span class="literal">true</span>;&#125; <span class="keyword">else</span>&#123;is_in_function=<span class="literal">false</span>;&#125;&#125;</span><br><span class="line">       | ID LP RP                       &#123;<span class="built_in">connect_to_next</span>(<span class="number">3</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;FunDec&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="keyword">if</span>(<span class="built_in">add_dec</span>($<span class="number">1</span>-&gt;id,<span class="string">&quot;function&quot;</span>,$<span class="number">1</span>-&gt;lineno)&amp;&amp;<span class="built_in">add_func_or_struct</span>($<span class="number">1</span>-&gt;id,$<span class="number">1</span>-&gt;lineno,<span class="string">&quot;function&quot;</span>))&#123;current_function_name=$<span class="number">1</span>-&gt;id;is_in_function=<span class="literal">true</span>;&#125; <span class="keyword">else</span>&#123;is_in_function=<span class="literal">false</span>;&#125;&#125;</span><br><span class="line">       | ID LP VarList error            &#123;<span class="built_in">printf</span>(<span class="string">&quot;Error type B at line %d: missing closing symbols &#x27;)&#x27;\n&quot;</span>, $<span class="number">1</span>-&gt;lineno);&#125;  </span><br><span class="line">       | ID LP error                    &#123;<span class="built_in">printf</span>(<span class="string">&quot;Error type B at line %d: missing closing symbols &#x27;)&#x27;\n&quot;</span>, $<span class="number">1</span>-&gt;lineno);&#125; </span><br><span class="line"></span><br><span class="line">VarList: ParamDec COMMA VarList         &#123;<span class="built_in">connect_to_next</span>(<span class="number">3</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;VarList&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);&#125;</span><br><span class="line">        | ParamDec                      &#123;$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;VarList&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);&#125;</span><br><span class="line"></span><br><span class="line">ParamDec: Specifier VarDec              &#123;<span class="built_in">connect_to_next</span>(<span class="number">2</span>,$<span class="number">1</span>,$<span class="number">2</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;ParamDec&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);&#125;</span><br><span class="line"></span><br><span class="line">CompSt: LC DefList StmtList RC          &#123;<span class="built_in">connect_to_next</span>(<span class="number">4</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>,$<span class="number">4</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;CompSt&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);&#125;</span><br><span class="line"></span><br><span class="line">StmtList: Stmt StmtList                 &#123;<span class="built_in">connect_to_next</span>(<span class="number">2</span>,$<span class="number">1</span>,$<span class="number">2</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;StmtList&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);&#125;</span><br><span class="line">         |Stmt Def StmtList error       &#123;<span class="built_in">printf</span>(<span class="string">&quot;Error type B at line %d: definition after statement\n&quot;</span>, $<span class="number">2</span>-&gt;lineno);&#125;</span><br><span class="line">         | <span class="comment">/* empty */</span>                  &#123;$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;empty&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>,<span class="number">100</span>);&#125;</span><br><span class="line"></span><br><span class="line">Stmt: Exp SEMI                          &#123;<span class="built_in">connect_to_next</span>(<span class="number">2</span>,$<span class="number">1</span>,$<span class="number">2</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Stmt&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);&#125;</span><br><span class="line">    | CompSt                            &#123;$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Stmt&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);&#125;</span><br><span class="line">    | RETURN Exp SEMI                   &#123;<span class="built_in">connect_to_next</span>(<span class="number">3</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Stmt&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);&#125;</span><br><span class="line">    | RETURN Exp error                  &#123;<span class="built_in">printf</span>(<span class="string">&quot;Error type B at line %d: missing semicolon &#x27;;&#x27;\n&quot;</span>, $<span class="number">1</span>-&gt;lineno);&#125;     </span><br><span class="line">    | IF LP Exp RP Stmt                 &#123;<span class="built_in">connect_to_next</span>(<span class="number">5</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>,$<span class="number">4</span>,$<span class="number">5</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Stmt&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);&#125;</span><br><span class="line">    | IF LP Exp RP Stmt ELSE Stmt       &#123;<span class="built_in">connect_to_next</span>(<span class="number">7</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>,$<span class="number">4</span>,$<span class="number">5</span>,$<span class="number">6</span>,$<span class="number">7</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Stmt&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);&#125;</span><br><span class="line">    | WHILE LP Exp RP Stmt              &#123;<span class="built_in">connect_to_next</span>(<span class="number">5</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>,$<span class="number">4</span>,$<span class="number">5</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Stmt&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);&#125;</span><br><span class="line"></span><br><span class="line">DefList: Def DefList                    &#123;<span class="built_in">connect_to_next</span>(<span class="number">2</span>,$<span class="number">1</span>,$<span class="number">2</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;DefList&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);&#125;</span><br><span class="line">        | <span class="comment">/* empty */</span>                   &#123;$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;empty&quot;</span>,<span class="string">&quot;&quot;</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>,<span class="number">100</span>);&#125;</span><br><span class="line"></span><br><span class="line">Def: Specifier DecList SEMI             &#123;<span class="built_in">connect_to_next</span>(<span class="number">3</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Def&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="built_in">check_Def</span>($$);&#125;</span><br><span class="line">    | Specifier DecList error           &#123;<span class="built_in">printf</span>(<span class="string">&quot;Error type B at line %d: missing semicolon &#x27;;&#x27;\n&quot;</span>, $<span class="number">1</span>-&gt;lineno);&#125;</span><br><span class="line"></span><br><span class="line">DecList: Dec                            &#123;$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;DecList&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);&#125;</span><br><span class="line">        | Dec COMMA DecList             &#123;<span class="built_in">connect_to_next</span>(<span class="number">3</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;DecList&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);&#125;</span><br><span class="line"></span><br><span class="line">Dec: VarDec                             &#123;$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Dec&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="built_in">insert_func_variables</span>($$);&#125;</span><br><span class="line">    | VarDec ASSIGN Exp                 &#123;<span class="built_in">connect_to_next</span>(<span class="number">3</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Dec&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="built_in">insert_func_variables</span>($$);&#125;</span><br><span class="line"></span><br><span class="line">Exp: Exp ASSIGN Exp                     &#123;<span class="built_in">connect_to_next</span>(<span class="number">3</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Exp&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="built_in">check_exp_assign</span>($<span class="number">1</span>,$<span class="number">3</span>);<span class="built_in">set_rvalue</span>($$);<span class="built_in">set_EXP_value_type</span>($$,<span class="string">&quot;int&quot;</span>);&#125;</span><br><span class="line">    | Exp AND Exp                       &#123;<span class="built_in">connect_to_next</span>(<span class="number">3</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Exp&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="built_in">check_exp_logical_symbols</span>($<span class="number">1</span>,$<span class="number">3</span>);<span class="built_in">set_rvalue</span>($$);<span class="built_in">set_EXP_value_type</span>($$,<span class="string">&quot;int&quot;</span>);&#125;</span><br><span class="line">    | Exp OR Exp                        &#123;<span class="built_in">connect_to_next</span>(<span class="number">3</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Exp&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="built_in">check_exp_logical_symbols</span>($<span class="number">1</span>,$<span class="number">3</span>);<span class="built_in">set_rvalue</span>($$);<span class="built_in">set_EXP_value_type</span>($$,<span class="string">&quot;int&quot;</span>);&#125;    </span><br><span class="line">    | Exp LT Exp                        &#123;<span class="built_in">connect_to_next</span>(<span class="number">3</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Exp&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="built_in">check_exp_logical_symbols</span>($<span class="number">1</span>,$<span class="number">3</span>);<span class="built_in">set_rvalue</span>($$);<span class="built_in">set_EXP_value_type</span>($$,<span class="string">&quot;int&quot;</span>);&#125;    </span><br><span class="line">    | Exp LE Exp                        &#123;<span class="built_in">connect_to_next</span>(<span class="number">3</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Exp&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="built_in">check_exp_logical_symbols</span>($<span class="number">1</span>,$<span class="number">3</span>);<span class="built_in">set_rvalue</span>($$);<span class="built_in">set_EXP_value_type</span>($$,<span class="string">&quot;int&quot;</span>);&#125;    </span><br><span class="line">    | Exp GT Exp                        &#123;<span class="built_in">connect_to_next</span>(<span class="number">3</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Exp&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="built_in">check_exp_logical_symbols</span>($<span class="number">1</span>,$<span class="number">3</span>);<span class="built_in">set_rvalue</span>($$);<span class="built_in">set_EXP_value_type</span>($$,<span class="string">&quot;int&quot;</span>);&#125;</span><br><span class="line">    | Exp GE Exp                        &#123;<span class="built_in">connect_to_next</span>(<span class="number">3</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Exp&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="built_in">check_exp_logical_symbols</span>($<span class="number">1</span>,$<span class="number">3</span>);<span class="built_in">set_rvalue</span>($$);<span class="built_in">set_EXP_value_type</span>($$,<span class="string">&quot;int&quot;</span>);&#125;</span><br><span class="line">    | Exp NE Exp                        &#123;<span class="built_in">connect_to_next</span>(<span class="number">3</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Exp&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="built_in">check_exp_logical_symbols</span>($<span class="number">1</span>,$<span class="number">3</span>);<span class="built_in">set_rvalue</span>($$);<span class="built_in">set_EXP_value_type</span>($$,<span class="string">&quot;int&quot;</span>);&#125;</span><br><span class="line">    | Exp EQ Exp                        &#123;<span class="built_in">connect_to_next</span>(<span class="number">3</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Exp&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="built_in">check_exp_logical_symbols</span>($<span class="number">1</span>,$<span class="number">3</span>);<span class="built_in">set_rvalue</span>($$);<span class="built_in">set_EXP_value_type</span>($$,<span class="string">&quot;int&quot;</span>);&#125;</span><br><span class="line">    | Exp PLUS Exp                      &#123;<span class="built_in">connect_to_next</span>(<span class="number">3</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Exp&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="built_in">check_exp_arithmetic_symbols</span>($<span class="number">1</span>,$<span class="number">3</span>);<span class="built_in">set_rvalue</span>($$);<span class="built_in">set_EXP_value_type</span>($$,$<span class="number">1</span>-&gt;value_type);&#125;</span><br><span class="line">    | Exp MINUS Exp                     &#123;<span class="built_in">connect_to_next</span>(<span class="number">3</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Exp&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="built_in">check_exp_arithmetic_symbols</span>($<span class="number">1</span>,$<span class="number">3</span>);<span class="built_in">set_rvalue</span>($$);<span class="built_in">set_EXP_value_type</span>($$,$<span class="number">1</span>-&gt;value_type);&#125;</span><br><span class="line">    | Exp MUL Exp                       &#123;<span class="built_in">connect_to_next</span>(<span class="number">3</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Exp&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="built_in">check_exp_arithmetic_symbols</span>($<span class="number">1</span>,$<span class="number">3</span>);<span class="built_in">set_rvalue</span>($$);<span class="built_in">set_EXP_value_type</span>($$,$<span class="number">1</span>-&gt;value_type);&#125;</span><br><span class="line">    | Exp DIV Exp                       &#123;<span class="built_in">connect_to_next</span>(<span class="number">3</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Exp&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="built_in">check_exp_arithmetic_symbols</span>($<span class="number">1</span>,$<span class="number">3</span>);<span class="built_in">set_rvalue</span>($$);<span class="built_in">set_EXP_value_type</span>($$,$<span class="number">1</span>-&gt;value_type);&#125;</span><br><span class="line">    | LP Exp RP                         &#123;<span class="built_in">connect_to_next</span>(<span class="number">3</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Exp&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="built_in">strcpy</span>($$-&gt;value_type,$<span class="number">2</span>-&gt;value_type);$$-&gt;rvalue=$<span class="number">2</span>-&gt;rvalue;&#125;    <span class="comment">//(b)</span></span><br><span class="line">    | LP Exp error                      &#123;<span class="built_in">printf</span>(<span class="string">&quot;Error type B at line %d: missing closing symbols &#x27;)&#x27;\n&quot;</span>, $<span class="number">1</span>-&gt;lineno);&#125;</span><br><span class="line">    | MINUS Exp                         &#123;<span class="built_in">connect_to_next</span>(<span class="number">2</span>,$<span class="number">1</span>,$<span class="number">2</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Exp&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="built_in">check_single_arithmetic_exp</span>($<span class="number">2</span>);$$-&gt;rvalue=$<span class="number">2</span>-&gt;rvalue;<span class="built_in">set_EXP_value_type</span>($$,$<span class="number">2</span>-&gt;value_type);&#125;</span><br><span class="line">    | NOT Exp                           &#123;<span class="built_in">connect_to_next</span>(<span class="number">2</span>,$<span class="number">1</span>,$<span class="number">2</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Exp&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="built_in">check_single_logical_exp</span>($<span class="number">2</span>);$$-&gt;rvalue=$<span class="number">2</span>-&gt;rvalue;<span class="built_in">set_EXP_value_type</span>($$,$<span class="number">2</span>-&gt;value_type);&#125;</span><br><span class="line">    | ID LP Args RP                     &#123;<span class="built_in">connect_to_next</span>(<span class="number">4</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>,$<span class="number">4</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Exp&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="keyword">if</span>(<span class="built_in">check_if_func_exist</span>($<span class="number">1</span>-&gt;id,$<span class="number">1</span>-&gt;lineno))&#123;<span class="built_in">check_func_args</span>($<span class="number">1</span>-&gt;id,$<span class="number">3</span>,<span class="number">0</span>);<span class="built_in">set_EXP_value_type</span>($$,<span class="built_in">find_func_return_type</span>($<span class="number">1</span>-&gt;id));&#125; <span class="keyword">else</span>&#123;<span class="built_in">set_EXP_value_type</span>($$,<span class="string">&quot;error&quot;</span>);&#125;&#125;         <span class="comment">//调用函数a(...)</span></span><br><span class="line">    | ID LP Args error                  &#123;<span class="built_in">printf</span>(<span class="string">&quot;Error type B at line %d: missing closing symbols &#x27;)&#x27;\n&quot;</span>, $<span class="number">1</span>-&gt;lineno);&#125;</span><br><span class="line">    | ID LP RP                          &#123;<span class="built_in">connect_to_next</span>(<span class="number">3</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Exp&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="keyword">if</span>(<span class="built_in">check_if_func_exist</span>($<span class="number">1</span>-&gt;id,$<span class="number">1</span>-&gt;lineno))&#123;<span class="built_in">check_func_without_args</span>($<span class="number">1</span>-&gt;id,$<span class="number">1</span>-&gt;lineno);<span class="built_in">set_EXP_value_type</span>($$,<span class="built_in">find_func_return_type</span>($<span class="number">1</span>-&gt;id));&#125; <span class="keyword">else</span>&#123;<span class="built_in">set_EXP_value_type</span>($$,<span class="string">&quot;error&quot;</span>);&#125;&#125;    <span class="comment">//调用函数，无参数</span></span><br><span class="line">    | Exp LB Exp RB                     &#123;<span class="built_in">connect_to_next</span>(<span class="number">4</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>,$<span class="number">4</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Exp&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="keyword">if</span>(<span class="built_in">check_exp_array</span>($<span class="number">1</span>,$<span class="number">3</span>))&#123;<span class="keyword">if</span>(index_error)&#123;<span class="built_in">set_EXP_value_type</span>($$,<span class="string">&quot;None&quot;</span>);index_error=<span class="literal">false</span>;&#125;<span class="keyword">else</span>&#123;<span class="built_in">set_EXP_value_type</span>($$,<span class="built_in">find_array_elem_type</span>($<span class="number">1</span>));&#125;&#125;<span class="keyword">else</span>&#123;<span class="built_in">set_EXP_value_type</span>($$,<span class="string">&quot;error&quot;</span>);&#125;&#125;     <span class="comment">//数组访问a[...]</span></span><br><span class="line">    | Exp DOT ID                        &#123;<span class="built_in">connect_to_next</span>(<span class="number">3</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Exp&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="keyword">if</span>(<span class="built_in">check_exp_structure</span>($<span class="number">1</span>,$<span class="number">3</span>))&#123;<span class="built_in">set_EXP_value_type</span>($$,<span class="built_in">find_structure_member_type</span>($<span class="number">1</span>-&gt;value_type,$<span class="number">3</span>-&gt;id));&#125;<span class="keyword">else</span>&#123;<span class="built_in">strcpy</span>($$-&gt;value_type,<span class="string">&quot;None&quot;</span>);&#125;&#125;    <span class="comment">//结构体</span></span><br><span class="line">    | ID                                &#123;$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Exp&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="built_in">set_EXP_value_type</span>($$,<span class="built_in">check_exp_id</span>($<span class="number">1</span>));&#125;</span><br><span class="line">    | INT                               &#123;$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Exp&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="built_in">set_EXP_value_type</span>($$,<span class="string">&quot;int&quot;</span>);$$-&gt;rvalue=<span class="number">1</span>;&#125;</span><br><span class="line">    | FLOAT                             &#123;$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Exp&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="built_in">set_EXP_value_type</span>($$,<span class="string">&quot;float&quot;</span>);$$-&gt;rvalue=<span class="number">1</span>;&#125;</span><br><span class="line">    | CHAR                              &#123;$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Exp&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);<span class="built_in">set_EXP_value_type</span>($$,<span class="string">&quot;char&quot;</span>);$$-&gt;rvalue=<span class="number">1</span>;&#125;</span><br><span class="line">    | ILLEGAL error                     &#123;<span class="built_in">printf</span>(<span class="string">&quot;Error type A at line %d: unknown lexeme &#x27;%s&#x27;\n&quot;</span>, $<span class="number">1</span>-&gt;lineno,$<span class="number">1</span>-&gt;id);&#125;</span><br><span class="line">    | ILLEGAL_HEX_INT error             &#123;<span class="built_in">printf</span>(<span class="string">&quot;Error type A at line %d: illegal hexadecimal integer &#x27;%s&#x27;\n&quot;</span>, $<span class="number">1</span>-&gt;lineno,$<span class="number">1</span>-&gt;id);&#125;</span><br><span class="line">    | ILLEGAL_CHAR error                &#123;<span class="built_in">printf</span>(<span class="string">&quot;Error type A at line %d: illegal hex_character &#x27;%s&#x27;\n&quot;</span>, $<span class="number">1</span>-&gt;lineno,$<span class="number">1</span>-&gt;id);&#125;</span><br><span class="line">    | Exp ILLEGAL Exp error             &#123;<span class="built_in">printf</span>(<span class="string">&quot;Error type A at line %d: illegal operator &#x27;%s&#x27;\n&quot;</span>, $<span class="number">2</span>-&gt;lineno,$<span class="number">2</span>-&gt;id);&#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">Args: Exp COMMA Args                    &#123;<span class="built_in">connect_to_next</span>(<span class="number">3</span>,$<span class="number">1</span>,$<span class="number">2</span>,$<span class="number">3</span>);$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Args&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);&#125;</span><br><span class="line">     | Exp                              &#123;$$=<span class="built_in">create_Node</span>(<span class="number">0</span>,<span class="string">&quot;Args&quot;</span>,<span class="string">&quot;&quot;</span>,$<span class="number">1</span>,<span class="literal">NULL</span>,<span class="number">0</span>);&#125;</span><br><span class="line"></span><br><span class="line">%%</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">yyerror</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//printf(&quot;Syntax error at line %d: %s\n&quot;, line, s);</span></span><br><span class="line">    <span class="comment">//printf(&quot;Error type B at line &quot;);</span></span><br><span class="line">    flag=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">return</span> ;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(stderr, <span class="string">&quot;Usage: %s &lt;file_path&gt;\n&quot;</span>, argv[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!(yyin = <span class="built_in">fopen</span>(argv[<span class="number">1</span>], <span class="string">&quot;r&quot;</span>))) &#123;</span><br><span class="line">        <span class="built_in">perror</span>(argv[<span class="number">1</span>]);</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">yyparse</span>();</span><br><span class="line">    <span class="keyword">if</span>(flag==<span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//print_tree(root,0);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    printf(&quot;\ntables:\n&quot;);</span></span><br><span class="line"><span class="comment">    //打印符号表</span></span><br><span class="line"><span class="comment">    for(int i=0;i&lt;dec_num;i++)</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        printf(&quot;%s %s\n&quot;,dec[i].name,dec[i].type);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    //打印定义表</span></span><br><span class="line"><span class="comment">    for(int i=0;i&lt;def_num;i++)</span></span><br><span class="line"><span class="comment">    &#123;</span></span><br><span class="line"><span class="comment">        printf(&quot;%s \n&quot;,def[i].name);</span></span><br><span class="line"><span class="comment">        for(int j=0;j&lt;def[i].arg_num;j++)</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">            printf(&quot;%s %s\n&quot;,def[i].args[j].name,def[i].args[j].type);</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        for(int j=0;j&lt;def[i].dec_num;j++)</span></span><br><span class="line"><span class="comment">        &#123;</span></span><br><span class="line"><span class="comment">            printf(&quot;%s %s\n&quot;,def[i].dec[j].name,def[i].dec[j].type);</span></span><br><span class="line"><span class="comment">        &#125;</span></span><br><span class="line"><span class="comment">        printf(&quot;return_type:%s\n&quot;,def[i].return_type);</span></span><br><span class="line"><span class="comment">    &#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>Makefile</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">CC=gcc</span><br><span class="line">FLEX=flex</span><br><span class="line">BISON=bison</span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="keyword">.PHONY</span>: bplc clean</span></span><br><span class="line"></span><br><span class="line"><span class="section">bplc: bin/bplc</span></span><br><span class="line"></span><br><span class="line"><span class="section">bin/bplc: bin myhead.o syntax.tab.o</span></span><br><span class="line">	<span class="variable">$(CC)</span> -o bin/bplc myhead.o syntax.tab.o -lfl -ly</span><br><span class="line"></span><br><span class="line"><span class="section">myhead.o: myhead.cpp</span></span><br><span class="line">	<span class="variable">$(CXX)</span> -c myhead.cpp -o myhead.o</span><br><span class="line"></span><br><span class="line"><span class="section">syntax.tab.o: syntax.tab.c</span></span><br><span class="line">	<span class="variable">$(CC)</span> -c syntax.tab.c -o syntax.tab.o</span><br><span class="line"></span><br><span class="line"><span class="section">syntax.tab.c: syntax.y lex.yy.c</span></span><br><span class="line">	<span class="variable">$(BISON)</span> -t -d syntax.y</span><br><span class="line"></span><br><span class="line"><span class="section">lex.yy.c: lex.l</span></span><br><span class="line">	<span class="variable">$(FLEX)</span> lex.l</span><br><span class="line"></span><br><span class="line"><span class="section">bin:</span></span><br><span class="line">	mkdir bin</span><br><span class="line"></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">	@rm -f lex.yy.c syntax.tab.* ./bin/* *.o</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>bplc_test.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pathlib</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DATA = pathlib.Path(<span class="string">&#x27;test&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">jsonparser_output</span>(<span class="params">json_file</span>):</span><br><span class="line">    out = subprocess.check_output([<span class="string">&#x27;./bin/bplc&#x27;</span>, json_file])</span><br><span class="line">    <span class="keyword">return</span> out.decode().strip()</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check_jsonchecker_fail_syntaxonly</span>():</span><br><span class="line">    data = DATA</span><br><span class="line">    <span class="keyword">for</span> bplfile <span class="keyword">in</span> data.glob(<span class="string">&#x27;*.bpl&#x27;</span>):</span><br><span class="line">        out = jsonparser_output(bplfile)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;For file <span class="subst">&#123;bplfile.name&#125;</span>:&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(out)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;#&#x27;</span>*<span class="number">80</span>)</span><br><span class="line">        subfolder_name = <span class="string">&quot;out&quot;</span></span><br><span class="line">        temp=bplfile.name[<span class="number">0</span>:<span class="number">10</span>]</span><br><span class="line">        file_name = <span class="string">f&quot;./<span class="subst">&#123;subfolder_name&#125;</span>/&quot;</span>+temp+<span class="string">&quot;.out&quot;</span></span><br><span class="line">        <span class="keyword">with</span> <span class="built_in">open</span>(file_name, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">            file.write(out)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># check_jsonchecker_fail_withlexical()</span></span><br><span class="line">check_jsonchecker_fail_syntaxonly()</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>myhead.h</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> MYHEAD_H_  <span class="comment">// 防止头文件重复包含</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MYHEAD_H_</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus  <span class="comment">// 允许C++调用C语言代码</span></span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span> &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdbool.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个结构体，用于描述变量声明</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="type">char</span> name[<span class="number">100</span>];  <span class="comment">// 变量名</span></span><br><span class="line">    <span class="type">char</span> type[<span class="number">100</span>];  <span class="comment">// 变量类型</span></span><br><span class="line">&#125; declare;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个结构体，用于描述复杂类型的定义，包括数组、结构体和函数</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> &#123;</span><br><span class="line">    <span class="type">char</span> name[<span class="number">100</span>];          <span class="comment">// 名称</span></span><br><span class="line">    <span class="type">char</span> elem_type[<span class="number">100</span>];     <span class="comment">// 对于数组类型，表示元素的类型</span></span><br><span class="line">    declare dec[<span class="number">100</span>];        <span class="comment">// 存储结构体成员或函数内部变量</span></span><br><span class="line">    <span class="type">char</span> return_type[<span class="number">100</span>];   <span class="comment">// 对于函数类型，表示返回值类型</span></span><br><span class="line">    declare args[<span class="number">100</span>];       <span class="comment">// 对于函数，存储参数列表</span></span><br><span class="line">    <span class="type">int</span> arg_num;             <span class="comment">// 函数参数的数量</span></span><br><span class="line">    <span class="type">int</span> dec_num;             <span class="comment">// dec数组中的元素数量</span></span><br><span class="line">&#125; definition;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> declare dec[<span class="number">100</span>];     <span class="comment">// 全局变量表</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">int</span> dec_num;          <span class="comment">// 全局变量数目</span></span><br><span class="line"><span class="keyword">extern</span> definition def[<span class="number">100</span>];  <span class="comment">// 复杂类型定义数组</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">int</span> def_num;          <span class="comment">// 复杂类型定义数目</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">char</span> last_type[<span class="number">100</span>];  <span class="comment">// 上一次定义的类型名称</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 函数声明</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">set_last_type</span><span class="params">(<span class="type">char</span> *type)</span></span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">add_dec</span><span class="params">(<span class="type">char</span> *name, <span class="type">char</span> *type, <span class="type">int</span> lineno)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add_array</span><span class="params">(<span class="type">char</span> *name, <span class="type">char</span> *elem_type, <span class="type">int</span> lineno)</span></span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">add_func_or_struct</span><span class="params">(<span class="type">char</span> *name, <span class="type">int</span> lineno, <span class="type">char</span> *type)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build_func_and_struct_dec</span><span class="params">(<span class="type">char</span> *name, <span class="type">char</span> *dec_name, <span class="type">char</span> *type)</span></span>;</span><br><span class="line"><span class="function"><span class="type">char</span>* <span class="title">find_id_type</span><span class="params">(<span class="type">char</span> *name)</span></span>;</span><br><span class="line"><span class="function">declare* <span class="title">find_func_or_struct_dec</span><span class="params">(<span class="type">char</span> *name)</span></span>;</span><br><span class="line"><span class="function"><span class="type">char</span>* <span class="title">find_func_return_type</span><span class="params">(<span class="type">char</span> *name)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add_struct_member</span><span class="params">(<span class="type">char</span> *struct_name, <span class="type">char</span> *member_name, <span class="type">char</span> *member_type, <span class="type">int</span> lineno)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add_func_args</span><span class="params">(<span class="type">char</span> *func_name, <span class="type">char</span> *arg_name, <span class="type">char</span> *arg_type, <span class="type">int</span> lineno)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add_func_variables</span><span class="params">(<span class="type">char</span> *func_name, <span class="type">char</span> *variable_name, <span class="type">char</span> *variable_type, <span class="type">int</span> lineno)</span></span>;</span><br><span class="line"><span class="function"><span class="type">char</span>* <span class="title">find_structure_member_type</span><span class="params">(<span class="type">char</span> *struct_name, <span class="type">char</span> *member_name)</span></span>;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">set_func_return_type</span><span class="params">(<span class="type">char</span> *func_name, <span class="type">char</span> *return_type)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> __cplusplus</span></span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span> <span class="comment">/* MYHEAD_H_ */</span></span></span><br></pre></td></tr></table></figure>



<p>myhead.cpp</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;myhead.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;cstring&gt;</span></span></span><br><span class="line"></span><br><span class="line">declare dec[<span class="number">100</span>];<span class="comment">//定义的变量表</span></span><br><span class="line"><span class="type">int</span> dec_num=<span class="number">0</span>;<span class="comment">//定义的变量数目</span></span><br><span class="line">definition def[<span class="number">100</span>];<span class="comment">//定义的array,struct,function</span></span><br><span class="line"><span class="type">int</span> def_num=<span class="number">0</span>;<span class="comment">//定义的array,struct,function数目</span></span><br><span class="line"><span class="type">char</span> last_type[<span class="number">100</span>];<span class="comment">//最后一次定义的类型</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">set_last_type</span><span class="params">(<span class="type">char</span> *type)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">strcpy</span>(last_type, type);  <span class="comment">// 直接复制类型名称到 last_type</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">add_dec</span><span class="params">(<span class="type">char</span> *name, <span class="type">char</span> *type, <span class="type">int</span> lineno)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 检查变量是否已经被定义过</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; dec_num; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(dec[i].name, name) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 根据已存在变量类型区分错误类型</span></span><br><span class="line">            <span class="type">const</span> <span class="type">char</span> *errorType =</span><br><span class="line">                <span class="built_in">strcmp</span>(dec[i].type, <span class="string">&quot;function&quot;</span>) == <span class="number">0</span> ? <span class="string">&quot;function&quot;</span> :</span><br><span class="line">                <span class="built_in">strcmp</span>(dec[i].type, <span class="string">&quot;structure&quot;</span>) == <span class="number">0</span> ? <span class="string">&quot;structure&quot;</span> :</span><br><span class="line">                <span class="string">&quot;variable&quot;</span>;</span><br><span class="line">            <span class="type">int</span> errorTypeCode = <span class="built_in">strcmp</span>(errorType, <span class="string">&quot;function&quot;</span>) == <span class="number">0</span> ? <span class="number">4</span> :</span><br><span class="line">                                <span class="built_in">strcmp</span>(errorType, <span class="string">&quot;structure&quot;</span>) == <span class="number">0</span> ? <span class="number">15</span> :</span><br><span class="line">                                <span class="number">3</span>;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Error type %d at Line %d: Redefined %s \&quot;%s\&quot;.\n&quot;</span>, errorTypeCode, lineno, errorType, name);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加新的定义</span></span><br><span class="line">    <span class="built_in">strcpy</span>(dec[dec_num].name, name);</span><br><span class="line">    <span class="built_in">strcpy</span>(dec[dec_num].type, type);</span><br><span class="line">    dec_num++;  <span class="comment">// 增加定义计数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add_array</span><span class="params">(<span class="type">char</span> *name, <span class="type">char</span> *elem_type, <span class="type">int</span> lineno)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 检查数组是否已经被定义过</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; def_num; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(def[i].name, name) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Error type 3 at Line %d: Redefined variable \&quot;%s\&quot;.\n&quot;</span>, lineno, name);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加新的数组定义</span></span><br><span class="line">    <span class="built_in">strcpy</span>(def[def_num].name, name);</span><br><span class="line">    <span class="built_in">strcpy</span>(def[def_num].elem_type, elem_type);</span><br><span class="line">    def[def_num].dec_num = <span class="number">0</span>;  <span class="comment">// 初始化数组内部变量计数为0</span></span><br><span class="line">    def_num++;  <span class="comment">// 增加定义计数</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">add_func_or_struct</span><span class="params">(<span class="type">char</span> *name, <span class="type">int</span> lineno, <span class="type">char</span> *type)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 检查是否已经定义过同名的函数或结构体</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; def_num; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(def[i].name, name) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 错误处理，根据类型输出不同的错误信息</span></span><br><span class="line">            <span class="type">int</span> errorTypeCode = <span class="built_in">strcmp</span>(type, <span class="string">&quot;function&quot;</span>) == <span class="number">0</span> ? <span class="number">4</span> : <span class="number">15</span>;</span><br><span class="line">            <span class="type">const</span> <span class="type">char</span> *typeText = <span class="built_in">strcmp</span>(type, <span class="string">&quot;function&quot;</span>) == <span class="number">0</span> ? <span class="string">&quot;function&quot;</span> : <span class="string">&quot;structure&quot;</span>;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;Error type %d at Line %d: Redefined %s \&quot;%s\&quot;.\n&quot;</span>, errorTypeCode, lineno, typeText, name);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加新的函数或结构体定义</span></span><br><span class="line">    <span class="built_in">strcpy</span>(def[def_num].name, name);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strcmp</span>(type, <span class="string">&quot;function&quot;</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">        def[def_num].arg_num = <span class="number">0</span>; <span class="comment">// 为函数初始化参数数量</span></span><br><span class="line">    &#125;</span><br><span class="line">    def[def_num].dec_num = <span class="number">0</span>; <span class="comment">// 初始化成员或局部变量数量</span></span><br><span class="line">    def_num++; <span class="comment">// 增加定义计数</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">build_func_and_struct_dec</span><span class="params">(<span class="type">char</span> *name, <span class="type">char</span> *dec_name, <span class="type">char</span> *type)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 查找并为特定的函数或结构体添加成员定义</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; def_num; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(def[i].name, name) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">strcpy</span>(def[i].dec[def[i].dec_num].name, dec_name);</span><br><span class="line">            <span class="built_in">strcpy</span>(def[i].dec[def[i].dec_num].type, type);</span><br><span class="line">            def[i].dec_num++; <span class="comment">// 更新成员计数</span></span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">char</span>* <span class="title">find_id_type</span><span class="params">(<span class="type">char</span> *name)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 遍历变量表，查找匹配的变量类型</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; dec_num; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(dec[i].name, name) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> dec[i].type; <span class="comment">// 返回找到的变量类型</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>; <span class="comment">// 找不到时返回NULL</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">declare* <span class="title">find_func_or_struct_dec</span><span class="params">(<span class="type">char</span> *name)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 遍历定义列表，寻找匹配的函数或结构体</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; def_num; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(def[i].name, name) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> def[i].dec; <span class="comment">// 找到后返回其声明数组</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>; <span class="comment">// 未找到返回NULL</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">char</span>* <span class="title">find_func_return_type</span><span class="params">(<span class="type">char</span> *name)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 遍历定义列表，寻找匹配的函数</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; def_num; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(def[i].name, name) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> def[i].return_type; <span class="comment">// 找到后返回其返回类型</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>; <span class="comment">// 未找到返回NULL</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add_struct_member</span><span class="params">(<span class="type">char</span> *struct_name, <span class="type">char</span> *member_name, <span class="type">char</span> *member_type, <span class="type">int</span> lineno)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 遍历定义列表以查找指定的结构体</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; def_num; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(def[i].name, struct_name) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 检查成员是否已经定义在结构体中</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; def[i].dec_num; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">strcmp</span>(def[i].dec[j].name, member_name) == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;Error type 15 at Line %d: Redefined field \&quot;%s\&quot;.\n&quot;</span>, lineno, member_name);</span><br><span class="line">                    <span class="keyword">return</span>; <span class="comment">// 找到重复定义，报错并退出</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 将新成员添加到结构体定义中</span></span><br><span class="line">            <span class="built_in">strcpy</span>(def[i].dec[def[i].dec_num].name, member_name);</span><br><span class="line">            <span class="built_in">strcpy</span>(def[i].dec[def[i].dec_num].type, member_type);</span><br><span class="line">            def[i].dec_num++; <span class="comment">// 更新成员数量</span></span><br><span class="line">            <span class="keyword">return</span>; <span class="comment">// 成功添加后退出</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add_func_args</span><span class="params">(<span class="type">char</span> *func_name, <span class="type">char</span> *arg_name, <span class="type">char</span> *arg_type, <span class="type">int</span> lineno)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 遍历定义列表以查找指定的函数</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; def_num; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(def[i].name, func_name) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 检查参数是否已经定义在函数中</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; def[i].arg_num; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">strcmp</span>(def[i].args[j].name, arg_name) == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;Error type 3 at Line %d: Redefined variable \&quot;%s\&quot;.\n&quot;</span>, lineno, arg_name);</span><br><span class="line">                    <span class="keyword">return</span>; <span class="comment">// 找到重复定义，报错并退出</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 将新参数添加到函数定义中</span></span><br><span class="line">            <span class="built_in">strcpy</span>(def[i].args[def[i].arg_num].name, arg_name);</span><br><span class="line">            <span class="built_in">strcpy</span>(def[i].args[def[i].arg_num].type, arg_type);</span><br><span class="line">            def[i].arg_num++; <span class="comment">// 更新参数数量</span></span><br><span class="line">            <span class="keyword">return</span>; <span class="comment">// 成功添加后退出</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">add_func_variables</span><span class="params">(<span class="type">char</span> *func_name, <span class="type">char</span> *variable_name, <span class="type">char</span> *variable_type, <span class="type">int</span> lineno)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 遍历已定义列表以查找指定函数</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; def_num; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(def[i].name, func_name) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 在找到的函数中遍历检查是否存在同名变量</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; def[i].dec_num; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">strcmp</span>(def[i].dec[j].name, variable_name) == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="built_in">printf</span>(<span class="string">&quot;Error type 3 at Line %d: Redefined variable \&quot;%s\&quot;.\n&quot;</span>, lineno, variable_name);</span><br><span class="line">                    <span class="keyword">return</span>; <span class="comment">// 发现重复定义，报错并退出</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 若未发现重复定义，则添加新变量</span></span><br><span class="line">            <span class="built_in">strcpy</span>(def[i].dec[def[i].dec_num].name, variable_name);</span><br><span class="line">            <span class="built_in">strcpy</span>(def[i].dec[def[i].dec_num].type, variable_type);</span><br><span class="line">            def[i].dec_num++; <span class="comment">// 更新变量数量</span></span><br><span class="line">            <span class="keyword">return</span>; <span class="comment">// 添加成功后退出</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">char</span>* <span class="title">find_structure_member_type</span><span class="params">(<span class="type">char</span> *struct_name, <span class="type">char</span> *member_name)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 遍历定义列表查找指定结构体</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; def_num; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(def[i].name, struct_name) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">// 在找到的结构体中遍历检查是否存在指定成员</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; def[i].dec_num; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">strcmp</span>(def[i].dec[j].name, member_name) == <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> def[i].dec[j].type; <span class="comment">// 找到成员，返回其类型</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NULL</span>; <span class="comment">// 指定成员不存在</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>; <span class="comment">// 指定结构体不存在</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">set_func_return_type</span><span class="params">(<span class="type">char</span> *name, <span class="type">char</span> *type)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 遍历已定义列表以查找指定函数</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; def_num; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(def[i].name, name) == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">strcpy</span>(def[i].return_type, type); <span class="comment">// 找到函数，设置返回类型</span></span><br><span class="line">            <span class="keyword">return</span>; <span class="comment">// 设置成功后退出</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://zhangyuanhe.top">Charmes</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://zhangyuanhe.top/2023/11/20/Information_Security_Experiment/Compilation_principle/CP_Project2/">https://zhangyuanhe.top/2023/11/20/Information_Security_Experiment/Compilation_principle/CP_Project2/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="null" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://zhangyuanhe.top" target="_blank">ZYH's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%8C%97%E9%82%AE%E4%BF%A1%E5%AE%89/">北邮信安</a><a class="post-meta__tags" href="/tags/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/">编译原理</a><a class="post-meta__tags" href="/tags/%E5%AE%9E%E9%AA%8C%E6%8A%A5%E5%91%8A/">实验报告</a></div><div class="post_share"><div class="social-share" data-image="/../../images/basic_configuration/wallhaven-0jp71w_1920x1080.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/11/20/Information_Security_Experiment/Compilation_principle/CP_Lab2/" title="编译原理Lab2——了解词法分析器生成器Lex并进行使用"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../../images/basic_configuration/wallhaven-0jp71w_1920x1080.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">编译原理Lab2——了解词法分析器生成器Lex并进行使用</div></div></a></div><div class="next-post pull-right"><a href="/2023/11/20/Information_Security_Experiment/Compilation_principle/CP_Lab1/" title="编译原理Lab1——编写链表功能代码"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../../images/basic_configuration/wallhaven-0jp71w_1920x1080.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">编译原理Lab1——编写链表功能代码</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/11/20/Information_Security_Experiment/Compilation_principle/CP_Lab1/" title="编译原理Lab1——编写链表功能代码"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../../images/basic_configuration/wallhaven-0jp71w_1920x1080.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-20</div><div class="title">编译原理Lab1——编写链表功能代码</div></div></a></div><div><a href="/2023/11/20/Information_Security_Experiment/Compilation_principle/CP_Lab2/" title="编译原理Lab2——了解词法分析器生成器Lex并进行使用"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../../images/basic_configuration/wallhaven-0jp71w_1920x1080.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-20</div><div class="title">编译原理Lab2——了解词法分析器生成器Lex并进行使用</div></div></a></div><div><a href="/2023/11/20/Information_Security_Experiment/Compilation_principle/CP_Lab3/" title="编译原理Lab3——实现Bison与Flex的交互"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../../images/basic_configuration/wallhaven-0jp71w_1920x1080.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-20</div><div class="title">编译原理Lab3——实现Bison与Flex的交互</div></div></a></div><div><a href="/2023/11/20/Information_Security_Experiment/Compilation_principle/CP_Lab4/" title="编译原理Lab4——实现错误检测"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../../images/basic_configuration/wallhaven-0jp71w_1920x1080.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-20</div><div class="title">编译原理Lab4——实现错误检测</div></div></a></div><div><a href="/2023/11/20/Information_Security_Experiment/Compilation_principle/CP_Lab5/" title="编译原理Lab5——编写symtab_ll.c"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../../images/basic_configuration/wallhaven-0jp71w_1920x1080.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-20</div><div class="title">编译原理Lab5——编写symtab_ll.c</div></div></a></div><div><a href="/2023/11/20/Information_Security_Experiment/Compilation_principle/CP_Project1/" title="编译原理Project1——编写词法分析和语法分析"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../../images/basic_configuration/wallhaven-0jp71w_1920x1080.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-11-20</div><div class="title">编译原理Project1——编写词法分析和语法分析</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="card-info-avatar"> <div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/favicon1.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-status-box"><div class="author-status"><g-emoji class="g-emoji" alias="palm_tree" fallback-src="https://lskypro.acozycotage.net/LightPicture/2022/12/fe1dc0402e623096.jpg">🐟</g-emoji><span>认真摸鱼中</span></div></div></div><div class="author-info__name">Charmes</div><div class="author-info__description">敏于思 慎于行</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">70</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">18</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">14</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/shuita2333"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/shuita2333" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:603747072@qq.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a><a class="social-icon" href="https://gitee.com/bank-beaver" target="_blank" title="Gitee"><i class="fab fa-git-square" style="color: #d5382a;"></i></a><a class="social-icon" href="/img/image-20230729200147469.png" target="_blank" title="wechat"><i class="fab fa-weixin" style="color: #3CB371;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来到我的博客━(*｀∀´*)ノ      有任何事宜可以在文末留言，链接过期可以私信我，我会尽快更新</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/07/07/hexo/SSL%E8%AF%81%E4%B9%A6%E7%BB%AD%E6%9C%9F%E6%B5%81%E7%A8%8B/" title="Hexo博客搭建（14）——SSl证书续期"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../../images/basic_configuration/image-20230729155123532.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Hexo博客搭建（14）——SSl证书续期"/></a><div class="content"><a class="title" href="/2024/07/07/hexo/SSL%E8%AF%81%E4%B9%A6%E7%BB%AD%E6%9C%9F%E6%B5%81%E7%A8%8B/" title="Hexo博客搭建（14）——SSl证书续期">Hexo博客搭建（14）——SSl证书续期</a><time datetime="2024-07-06T16:58:36.000Z" title="发表于 2024-07-07 00:58:36">2024-07-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/15/BUPT_note/Notes_on_software_security/" title="软件安全课程笔记"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../../images/basic_configuration/tags1-1690700892780-1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="软件安全课程笔记"/></a><div class="content"><a class="title" href="/2024/01/15/BUPT_note/Notes_on_software_security/" title="软件安全课程笔记">软件安全课程笔记</a><time datetime="2024-01-15T13:00:00.000Z" title="发表于 2024-01-15 21:00:00">2024-01-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/14/BUPT_note/Notes_on_Information_System_Security/" title="信息系统安全课程笔记"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../../images/basic_configuration/tags1-1690700892780-1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="信息系统安全课程笔记"/></a><div class="content"><a class="title" href="/2024/01/14/BUPT_note/Notes_on_Information_System_Security/" title="信息系统安全课程笔记">信息系统安全课程笔记</a><time datetime="2024-01-14T13:00:00.000Z" title="发表于 2024-01-14 21:00:00">2024-01-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/11/BUPT_note/Notes_on_Compilation_principle/" title="编译原理与技术课程笔记"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../../images/basic_configuration/tags1-1690700892780-1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="编译原理与技术课程笔记"/></a><div class="content"><a class="title" href="/2024/01/11/BUPT_note/Notes_on_Compilation_principle/" title="编译原理与技术课程笔记">编译原理与技术课程笔记</a><time datetime="2024-01-11T13:00:00.000Z" title="发表于 2024-01-11 21:00:00">2024-01-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/10/BUPT_note/Notes_on_Complex_network/" title="复杂网络课程笔记"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/../../images/basic_configuration/tags1-1690700892780-1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="复杂网络课程笔记"/></a><div class="content"><a class="title" href="/2024/01/10/BUPT_note/Notes_on_Complex_network/" title="复杂网络课程笔记">复杂网络课程笔记</a><time datetime="2024-01-10T13:00:00.000Z" title="发表于 2024-01-10 21:00:00">2024-01-10</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="footer-wrap"></div><div id="ft"><div class="ft-item-1"><div class="t-top"><div class="t-t-l"><p class="ft-t t-l-t">格言🧬</p><div class="bg-ad"><div>再看看那个光点，它就在这里，这是家园，这是我们 —— 你所爱的每一个人，你认识的一个人，你听说过的每一个人，曾经有过的每一个人，都在它上面度过他们的一生✨</div><div class="btn-xz-box"><a class="btn-xz" target="_blank" rel="noopener" href="https://stellarium.org/">点击开启星辰之旅</a></div></div></div><div class="t-t-r"><p class="ft-t t-l-t">猜你想看💡</p><ul class="ft-links"><li><a href="/link/">我的朋友</a></li><li> <a href="/about/">关于作者</a></li><li> <a href="/archives/">文章归档</a></li><li> <a href="/categories/">文章分类</a></li><li> <a href="/tags/">文章标签</a></li></ul></div></div></div><div class="ft-item-2"><p class="ft-t">推荐友链⌛</p><div class="ft-img-group"><div class="img-group-item"><a href="https://zhangyuanhe.top/" title="Charmes"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://zyhblog-1318929733.cos.ap-beijing.myqcloud.com/favicon1.png" alt=""/></a></div><div class="img-group-item"><a target="_blank" rel="noopener" href="https://liuruibin.com/" title="LRBlog"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lrblog-img-1304667442.file.myqcloud.com/method.jpg" alt=""/></a></div><div class="img-group-item"><a target="_blank" rel="noopener" href="https://akilar.top/" title="Akilarの糖果屋"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lskypro.acozycotage.net/LightPicture/2022/12/6bf1ed05796db59c.jpg" alt=""/></a></div><div class="img-group-item"><a target="_blank" rel="noopener" href="http://www.azuredust.cc" title="de4dst4r blog"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="http://www.azuredust.cc/wp-content/themes/personalblogily/inc/starter_content/img/portrait.png" alt=""/></a></div></div></div></div><div class="copyright"><span><b>&copy;2023 - 2024</b></span><span><b>&nbsp;&nbsp;By Charmes</b></span></div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a><span class="footer-separator">|</span><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src=/img/icp.png>
<a href="https://beian.miit.gov.cn/" target="_blank">京ICP备2023019220号-1</a></div><div id="workboard"></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><a class="icon-V hidden" onclick="switchNightMode()" title="浅色和深色模式转换"><svg width="25" height="25" viewBox="0 0 1024 1024"><use id="modeicon" xlink:href="#icon-moon"></use></svg></a><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button><button class="share" type="button" title="右键模式" onclick="changeMouseMode()"><i class="fas fa-mouse"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="直达底部" onclick="btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></button></div></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" href="javascript:window.history.back();"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" href="javascript:window.history.forward();"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" href="javascript:window.location.reload();"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" href="javascript:rmf.scrollToTop();"><i class="fa fa-arrow-up"></i></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa fa-copy"></i><span>复制</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();"><i class="fa fa-search"></i><span>百度搜索</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();"><i class="fa fa-link"></i><span>转到链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()"><i class="fa fa-copy"></i><span>粘贴</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="#post-comment"><i class="fas fa-comment"></i><span>空降评论</span></a><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()"><i class="fa fa-link"></i><span>复制本文地址</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>新窗口打开</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()"><i class="fa fa-link"></i><span>转到链接</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制链接</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()"><i class="fa fa-download"></i><span>保存图片</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>在新窗口打开</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>复制图片链接</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:randomPost()"><i class="fa fa-paper-plane"></i><span>随便逛逛</span></a><a class="rightMenu-item" href="javascript:switchNightMode();"><i class="fa fa-moon"></i><span>昼夜切换</span></a><a class="rightMenu-item" href="/about/"><i class="fa fa-info-circle"></i><span>关于博客</span></a><a class="rightMenu-item" href="javascript:toggleWinbox();"><i class="fas fa-cog"></i><span>美化设置</span></a><a class="rightMenu-item" href="javascript:rmf.fullScreen();"><i class="fas fa-expand"></i><span>切换全屏</span></a><a class="rightMenu-item" href="javascript:window.print();"><i class="fa-solid fa-print"></i><span>打印页面</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><div class="js-pjax"><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.zhangyuanhe.top/',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.zhangyuanhe.top/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.textContent = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><canvas id="universe"></canvas><script defer src="/js/universe.js"></script><script defer src="/js/light.js"></script><script defer type="text/javascript" src="https://cdn1.tianli0.top/npm/sweetalert2@8.19.0/dist/sweetalert2.all.js"></script><script defer src="/js/lunar.js"></script><script defer src="/js/day.js"></script><script src="/js/sun_moon.js" async></script><script type="text/javascript" src="https://cdn1.tianli0.top/npm/jquery@latest/dist/jquery.min.js"></script><script type="text/javascript" src="/js/rightmenu.js"></script><script defer src="/js/another.js"></script><script defer src="/js/runtime.js"></script><script async src="/js/fps.js"></script><script async src="/js/title.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><!-- hexo injector body_end start --> <script data-pjax>if(document.getElementById('recent-posts') && (location.pathname ==='/'|| '/' ==='all')){
    var parent = document.getElementById('recent-posts');
    var child = '<div class="recent-post-item" style="width:100%;height: auto"><div id="catalog_magnet"><div class="magnet_item"><a class="magnet_link" href="https://zhangyuanhe.top/categories/博客搭建/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📚 Charmesの魔改教程 (14)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zhangyuanhe.top/categories/课程笔记/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">📒 Charmesの学习笔记 (11)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item"><a class="magnet_link" href="https://zhangyuanhe.top/categories/信安课程实验/"><div class="magnet_link_context" style=""><span style="font-weight:500;flex:1">👩‍💻 Charmesの实验记录 (40)</span><span style="padding:0px 4px;border-radius: 8px;"><i class="fas fa-arrow-circle-right"></i></span></div></a></div><div class="magnet_item" style="visibility: hidden"></div><a class="magnet_link_more"  href="https://zhangyuanhe.top/categories" style="flex:1;text-align: center;margin-bottom: 10px;">查看更多...</a></div></div>';
    console.log('已挂载magnet')
    parent.insertAdjacentHTML("afterbegin",child)}
     </script><style>#catalog_magnet{flex-wrap: wrap;display: flex;width:100%;justify-content:space-between;padding: 10px 10px 0 10px;align-content: flex-start;}.magnet_item{flex-basis: calc(50% - 5px);background: #f2f2f2;margin-bottom: 10px;border-radius: 8px;transition: all 0.2s ease-in-out;}.magnet_item:hover{background: #b30070}.magnet_link_more{color:#555}.magnet_link{color:black}.magnet_link:hover{color:white}@media screen and (max-width: 600px) {.magnet_item {flex-basis: 100%;}}.magnet_link_context{display:flex;padding: 10px;font-size:16px;transition: all 0.2s ease-in-out;}.magnet_link_context:hover{padding: 10px 20px;}</style>
    <style></style><!-- hexo injector body_end end --><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false});</script></body></html>